
        <!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Авторизация</title>
    <style>
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: none;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-box {
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ff4444;
            border-radius: 4px;
            background: #ffeaea;
            color: #cc0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <form id="authForm">
            <input type="password" id="password" placeholder="Пароль" required>
            <button type="submit">Войти</button>
        </form>
        <div class="loader"></div>
        <div id="message"></div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzJph_SIelaZylWp9lDb5pLDKeHonzmAo6kpjFKvaAsfUFShCqgFRgIM4YZITDsgvMA/exec'; // Замените на реальный URL
        const MAX_RETRIES = 2;
        let retryCount = 0;

        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const loader = document.querySelector('.loader');
            const message = document.getElementById('message');
            
            // Сброс предыдущих ошибок
            message.innerHTML = '';
            loader.style.display = 'block';
            form.style.opacity = '0.5';
            form.querySelector('button').disabled = true;

            try {
                const response = await fetchWithRetry(
                    API_URL,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            password: document.getElementById('password').value,
                            ip: await getClientIP()
                        }),
                        signal: AbortSignal.timeout(8000) // Таймаут 8 секунд
                    }
                );

                const result = await response.json();
                
                if (result.status === 'success') {
                    window.location.href = result.redirect;
                } else {
                    throw new Error(result.message || 'Ошибка сервера');
                }
                
            } catch (error) {
                showError(error.message);
            } finally {
                loader.style.display = 'none';
                form.style.opacity = '1';
                form.querySelector('button').disabled = false;
            }
        });

        async function fetchWithRetry(url, options, retries = MAX_RETRIES) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response;
            } catch (error) {
                if (retries > 0) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    return fetchWithRetry(url, options, retries - 1);
                }
                throw new Error(`Сеть недоступна. Попробуйте позже.`);
            }
        }

        async function getClientIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json', {
                    signal: AbortSignal.timeout(3000)
                });
                return (await response.json()).ip;
            } catch (error) {
                return 'unknown';
            }
        }

        function showError(msg) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `
                <div class="error-box">
                    ${msg}
                </div>
            `;
        }
    </script>
</body>
</html>
