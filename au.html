


<!DOCTYPE html>
<html>
<head>
    <title>Авторизация</title>
    <style>
        .loader {
            display: none;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <form id="authForm">
            <input type="password" id="password" placeholder="Введите пароль" required>
            <button type="submit">Войти</button>
        </form>
        <div class="loader"></div>
        <div id="message"></div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzJph_SIelaZylWp9lDb5pLDKeHonzmAo6kpjFKvaAsfUFShCqgFRgIM4YZITDsgvMA/exec';
        const form = document.getElementById('authForm');
        const loader = document.querySelector('.loader');
        const message = document.getElementById('message');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            loader.style.display = 'block';
            form.style.display = 'none';
            message.textContent = '';

            try {
                // Получаем IP пользователя
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const {ip} = await ipResponse.json();

                // Основной запрос
                const authResponse = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        password: document.getElementById('password').value,
                        ip: ip
                    })
                });

                if (!authResponse.ok) {
                    throw new Error(`HTTP error! Status: ${authResponse.status}`);
                }

                const result = await authResponse.json();
                
                if (result.status === 'success') {
                    window.location.href = result.redirect;
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                showError(error.message);
            } finally {
                loader.style.display = 'none';
                form.style.display = 'block';
            }
        });

        function showError(msg) {
            message.innerHTML = `
                <div class="error" style="color: red; margin-top: 10px;">
                    ${msg}
                </div>
            `;
        }
    </script>
</body>
</html>
