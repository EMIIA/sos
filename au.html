<!DOCTYPE html>
<html>
<head>
    <title>Авторизация</title>
    <style>
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="auth-container">
        <form id="authForm">
            <input type="password" id="password" placeholder="Пароль" required>
            <button type="submit">Войти</button>
        </form>
        <div class="loader"></div>
        <div id="message"></div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzJph_SIelaZylWp9lDb5pLDKeHonzmAo6kpjFKvaAsfUFShCqgFRgIM4YZITDsgvMA/exec';
        const form = document.getElementById('authForm');
        const loader = document.querySelector('.loader');
        const message = document.getElementById('message');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Показать лоадер
            loader.style.display = 'block';
            form.style.display = 'none';
            message.textContent = '';

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        password: document.getElementById('password').value,
                        ip: await getIP()
                    }),
                    mode: 'cors'
                });

                if (!response.ok) throw new Error(`Ошибка HTTP: ${response.status}`);
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    window.location.href = result.redirect;
                } else {
                    throw new Error(result.message || 'Неизвестная ошибка');
                }
            } catch (error) {
                showError(error.message);
            } finally {
                loader.style.display = 'none';
                form.style.display = 'block';
            }
        });

        async function getIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                return (await response.json()).ip;
            } catch (error) {
                return 'unknown';
            }
        }

        function showError(msg) {
            message.innerHTML = `
                <div style="color: red; margin-top: 15px; padding: 10px; border: 1px solid #ffcccc;">
                    ${msg}
                </div>
            `;
        }
    </script>
</body>
</html>
