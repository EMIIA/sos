
















<!DOCTYPE html>
<html>
<head>



<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, interactive-widget=resizes-content">



<title>Dark Store</title>


		<link rel="shortcut icon" href="https://sos.emiia.ai/vv.ico" type="image/x-icon">
<meta name="theme-color" content="#f8f9fa">

<!-- Эти теги для соцсетей, для PWA не важны, но должны быть корректны -->
<meta property="og:type" content="website" />
<meta property="og:url" content="https://sos.emiia.ai/vv.html" />
<meta property="og:title" content="ВкусВилл"/>
<meta property="og:image" content="https://sos.emiia.ai/vvjpg.jpg" />
<meta name="twitter:card" content="summary_large_image" />

<!-- Критически важная ссылка для PWA -->
<link rel="manifest" href="https://sos.emiia.ai/vv.webmanifest">




<script src="https://telegram.org/js/telegram-web-app.js"></script>




<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js"></script>
<script src="/style/mapbox-gl.js" type="text/javascript"></script>


<link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet">
<style src="/style/mapbox-gl.css" type="text/javascript"></style>


<style>
@import url('https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

	<style>
@import url('https://www.emiia.ru/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

  <style>  
@import url('/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

<link rel="stylesheet" href="https://www.emiia.ru/cssfamily=Montserrat.css">
<link rel="stylesheet" href="/cssfamily=Montserrat.css">



<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; background: #f8f9fa; }
</style>
</head>
<body>

<style type="text/css">
    #info {
        display: table;
        position: relative;
        margin: 0px auto;
        word-wrap: anywhere;
        white-space: pre-wrap;
        padding: 10px;
        border: none;
        border-radius: 3px;
        font-size: 12px;
        text-align: center;
        color: #818cf8;
        background: transparent;



    }


@media (max-width: 768px) {
 #info {
    top: 100px; /* Новое значение для мобильных */
    right: 0%;
background: #f8f9fa;

  }
  }

</style>




<style>


.header {
    padding: 0rem;
    position: fixed;
    bottom: 70px;
    z-index: 20000;
    right: 5%;


}


@media (max-width: 768px) {
 .header {
    bottom: 25px; /* Новое значение для мобильных */
    right: 1%;

  }
}
</style>



<style type="text/css">
    
    
    
    a.mapboxgl-ctrl-logo{
    width: 0;
    height: 0;
    margin: 0 0 -4px-4px;
    display: block;
    background-repeat: no-repeat;
    cursor: pointer;
    overflow: hidden;
    background-image: url(data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E %3Cdefs%3E %3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E %3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E %3C/defs%3E %3Cmask id='clip'%3E %3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/mask%3E %3Cg id='outline' opacity='0.3' stroke='%23000' stroke-width='3'%3E %3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E %3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E %3C/g%3E %3Cg id='fill' opacity='0.9' fill='%23fff'%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/g%3E %3C/svg%3E);
}



    
    
</style>





























<script>
!function e(t,o,r){function i(s,a){if(!o[s]){if(!t[s])


{var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(n)return n(s,!0);var p=new Error("Cannot find module '"+s+"'");



throw p.code="MODULE_NOT_FOUND",p}var c=o[s]={exports:{}};t[s][0].call(c.exports,function(e){var o=t[s][1][e];return i(o||e)},c,c.exports,e,t,o,r)}return o[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,o){function r(e,t){if(!(this instanceof r))


throw new Error("MapboxMarkers needs to be called with the new keyword");this.URLSearchParams=new URLSearchParams(new URL(window.location).search),this._sourceName="markerspec",this._geojson=e,this._rendered=!1,this.options=Object.assign(




{disabled:this.URLSearchParams.get("disabled")||!0,showControl:this.URLSearchParams.get("show-control")||!0,marker:{image:""},



popup:{description:"<i></i>"},style:{label:"{name}",labelSize:10,color:this.URLSearchParams.get("style-color")||"transporent",size:2,opacity:1,icon:"marker",layers:null}},t),this.toggle=this.toggle.bind(this),this.render=this.render.bind(this),this._toggleLayers=this._toggleLayers.bind(this),this._updateMap=this._updateMap.bind(this),this._toggle=new i({show:this.options.showControl,onToggle:this.toggle.bind(this)})}function i(e){var t,o;e=Object.assign({show:!0,onToggle:function(){}},e),this._btn=((t=document.createElement("button")).className="mapboxgl-ctrl-icon mapboxgl-ctrl-markers",t.type="button",t["aria-label"]="Inspect",t),this._btn.onclick=e.onToggle,this._input=((o=document.createElement("input")).id="marker-search",o.type="text",o.placeholder="Marker Search",o.style.display="none",o),this.elem=function(e,t,o){var r=document.createElement("div");return r.className="mapboxgl-ctrl mapboxgl-ctrl-group markerspec",r.appendChild(e),o||(r.style.display="none"),r}(this._btn,this._input,e.show)}r.prototype.onAdd=function(e){return this._map=e,e.on("load",this.render),e.on("moveend",this._updateMap),this._toggle.elem},r.prototype.onRemove=function(){this._map.off("load",this.render);var e=this._toggle.elem;e.parentNode.removeChild(e),this._map=void 0},r.prototype.toggle=function(){this.options.enabled=!this.options.enabled,this.render()},r.prototype.render=function(){if(!this._rendered){var e=this;if(this.URLSearchParams.get("data")){var t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&(e._geojson=JSON.parse(t.responseText),o())},t.open("GET",this.URLSearchParams.get("data"),!0),t.send(null)}else o();function o(){e._geojson.features.forEach(function(t){if("Point"==t.geometry.type){var o=document.createElement("div");


o.className="markerspec marker",o.style=`background-image:url('${t.properties["marker-image"]||e.options.marker.image}')`,o.onclick=function(e){map.flyTo({center:t.geometry.coordinates})};var r=(void 0!==t.properties.title?`<h3>${t.properties.title}</h3>`:"")+(void 0!==t.properties.image?`<img src='${t.properties.image}' width=200 alt='${t.properties.title}'>`:"")+(void 0!==t.properties.description?`<p>${t.properties.description}</p>`:`<p>${e.options.popup.description}</p>`)+(void 0!==t.properties.website?`<a href='${t.properties.website}' target='_blank' class='button'>Website</a>`:`<a href='https://www.openstreetmap.org/?mlat=${t.geometry.coordinates[1]}&mlon=${t.geometry.coordinates[0]}' target='_blank' class='button'></a>`);


new mapboxgl.Marker(o).setLngLat(t.geometry.coordinates).setPopup(new mapboxgl.Popup({offset:25}).setHTML(r)).addTo(map)}}),e._map.addSource("markerspec",{type:"geojson",data:e._geojson});var t,o,r=e._map.getStyle().layers.filter(function(e){return"building"===e["source-layer"]}),i=r[r.length-1].id;e.options.style.layers||(e.options.style.layers=(t=e._sourceName,o=e.options.style,[{id:`${t} fill`,type:"fill",source:`${t}`,paint:{"fill-color":o.color,"fill-opacity":o.opacity},filter:["==","$type","Polygon"]},{id:`${t} line`,type:"line",source:`${t}`,paint:{"line-color":o.color,"line-width":o.size,"line-opacity":o.opacity}},{id:`${t} circle`,type:"circle",source:`${t}`,paint:{"circle-color":o.color,"circle-radius":o.size,"circle-opacity":o.opacity}},{id:`${t} symbol`,type:"symbol",source:`${t}`,





layout:{"text-field":o.label,"text-size":o.labelSize,"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"top","icon-image":"{icon}-25","road-label-navigation":!0}}]));var n=function(e,t,o){for(var r=0;r<e.layers.length;r++)






{var i=e.layers[r];if(o===i.id){var n=e.layers.slice(0,r).concat(t).concat(e.layers.slice(r));return Object.assign({},e,{layers:n})}}return e}(e._map.getStyle(),e.options.style.layers,i);e._map.setStyle(n),e._toggle._input.onkeypress=(t=>{if("Enter"===t.key)return e.options.query=e._toggle._input.value,e._updateMap(),!0})}this._rendered=!0}this.options.enabled?(this._toggleLayers(),this._toggle.setMapIcon()):(this._toggleLayers(),this._toggle.setPluginIcon())},r.prototype._updateMap=function(){this.options.enabled&&this.options._geojson&&console.log("Nothing to update")},i.prototype.setPluginIcon=function(){this._btn.className="mapboxgl-ctrl-icon mapboxgl-ctrl-markers"},i.prototype.setMapIcon=function(){this._btn.className="mapboxgl-ctrl-icon mapboxgl-ctrl-map"},r.prototype._toggleLayers=function(){var e=this.options.enabled;Array.from(document.getElementsByClassName("markerspec marker")).forEach(function(t){t.style.display=e?"inline":"none"});var t=new RegExp(this._sourceName),o=this._map.getStyle();o.layers.forEach(function(o){t.test(o.source)&&(o.layout=o.layout||{},o.layout.visibility=e?"visible":"none")}),this._map.setStyle(o),this._toggle._input.style.display=e?"inline":"none"},void 0!==t&&void 0!==t.exports?window.MapboxMarkers=r:t.exports=r},{}]},{},[1]); 




</script>



















 






<style type="text/css">
    #info {
        

 position: absolute;
        margin: 0px auto;
        word-wrap: anywhere;
        white-space: pre-wrap;
        padding: 10px;
        border: none;
        border-radius: 3px;
        font-size: 12px;
        text-align: left;
        color: #3d85c6;
        background: transparent;
        bottom: 55px !important;
        left: 8px;
        background-color: transparent;
        padding: 19.5px;
        font-family: 'Montserrat', montserrat !important; 



    }


@media (max-width: 768px) {
 #info {
    bottom: 55px !important; /* Сохранить как в десктопе */
        left: 8px; /* Сохранить как в десктопе */
        top: auto; /* Отменить top если он был установлен */
        right: auto; /* Отменить right если он был установлен */

  }





  }

</style>




<style>


.calculation-box {
   height: 30px;
    width: 300px;
    position: absolute;
    bottom: 110px !important;
    left: 18px;
    background-color: transparent;
    padding: 19.5px;
    font-family: 'Montserrat', montserrat !important; 
}




 
p {
font-family: 'Montserrat';
margin: 0px;
font-size: 10px;
color: #3d85c6;




}

.calculation-box p:not(:last-child) {
    margin-bottom: 10px; /* Применяется ко всем <p>, кроме последнего */





}

.highlight {
    font-size: 18px; /* Увеличьте значение по необходимости, например, 18px */
font-weight: 500; /* Жирность (700 = bold, 800 или 900 — ещё жирнее) */




}

.highlight1 {
    position: relative;
    top: 3px; /* Опускает стрелку на 3px вниз, измените значение по необходимости */
font-size: 18px; /* Увеличьте значение по необходимости, например, 18px */






}

</style>










<style>




.marker {
        background-image: url('https://sos.emiia.ai/vv_g_m_STORE_21_90EE90.svg');
        background-size: cover;
  width: 80px;
  height: 80px;
  border-radius: 0%;
  cursor: pointer;
      }
      .mapboxgl-popup {
        max-width: 200px;

      }
      .mapboxgl-popup-content {
        text-align: left;
        font-family: 'Montserrat', montserrat !important; 
        border-radius: 20px;
        background-color: #f8f9fa;
      }




:root {
  --popup-bg-color: #f8f9fa;
  --popup-text-color: #3d85c6;
  --close-button-color: #3d85c6;
  --close-button-hover-color: #383838;
  --close-button-bg-hover: rgba(0, 0, 0, 0.1);
}

.marker1 {
  background-image: url('https://sos.emiia.ai/vv_g_m_DARKSTORE_33_90EE90.svg');
  background-size: cover;
  width: 80px;
  height: 80px;
  border-radius: 0%;
  cursor: pointer;
}

.mapboxgl-popup {
  max-width: 290px;
}

.mapboxgl-popup-content {
  text-align: left;
  font-family: 'Montserrat', montserrat !important; 
  border-radius: 20px;
  background-color: var(--popup-bg-color);
  color: var(--popup-text-color);
  padding: 15px;
}

/* Правильное окрашивание хвостика для всех положений */
.mapboxgl-popup-anchor-top .mapboxgl-popup-tip {
  border-bottom-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip {
  border-bottom-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip {
  border-bottom-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
  border-top-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip {
  border-top-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {
  border-top-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-left .mapboxgl-popup-tip {
  border-right-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-right .mapboxgl-popup-tip {
  border-left-color: var(--popup-bg-color) !important;
}

/* Стили для кнопки закрытия (крестика) */
.mapboxgl-popup-close-button {
  color: var(--close-button-color);
  font-size: 18px;
  padding: 8px;
  margin: 2px;
  border: none;
  background: none;
  border-radius: 10px;
}

.mapboxgl-popup-close-button:hover {
  background-color: var(--close-button-bg-hover);
  color: var(--close-button-hover-color);
}

.mapboxgl-popup-close-button:focus {
  outline: none;
  box-shadow: none;
}






/* Стили для кнопки закрытия (крестика) */
.mapboxgl-popup-close-button {
  color: var(--close-button-color);
  font-size: 24px; /* Увеличил с 18px до 24px */
  padding: 12px; /* Увеличил с 8px до 12px */
  margin: 4px; /* Увеличил с 2px до 4px */
  border: none;
  background: none;
  border-radius: 12px; /* Увеличил с 10px до 12px */
  width: 40px; /* Добавил фиксированную ширину */
  height: 40px; /* Добавил фиксированную высоту */
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

/* Увеличение на мобильных устройствах */
@media (max-width: 768px) {
  .mapboxgl-popup-close-button {
    font-size: 28px; /* Еще больше на мобильных */
    padding: 14px;
    margin: 6px;
    width: 44px;
    height: 44px;
  }
}

/* Ховер-эффекты для лучшей UX */
.mapboxgl-popup-close-button:hover {
  background: rgba(0, 0, 0, 0.1);
  transform: scale(1.1);
}

.mapboxgl-popup-close-button:active {
  transform: scale(0.95);
}




</style>








<style>

/* Основные стили для размытия */
.blur-background {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    background-color: rgba(255, 255, 255, 0.1);
}

/* Альтернатива для браузеров без поддержки backdrop-filter */
.no-backdropfilter .blur-background {
    background-color: rgba(255, 255, 255, 0.8);
}

</style>







<style>
/* Подключаем тонкие начертания Montserrat */
@import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap');

/* Основные стили для popup */
.mapboxgl-popup {
    max-width: 250px !important;
    min-width: 250px !important;
    border-radius: 15px;
    font-family: 'Montserrat', sans-serif !important;
    z-index: 10000 !important;
}

.mapboxgl-popup-content {
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    padding: 15px;
    max-width: 250px !important;
    min-width: 250px !important;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
    width: 250px !important; /* Добавляем фиксированную ширину */
}

.iss-data {
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
    margin-top: 12px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 6px;
    border-left: 0px solid #3d85c6;
    max-width: 100%;
    z-index: 10000 !important;
}

.data-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 6px;
    margin: 10px 0;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
    z-index: 10000 !important;
}

.data-item {
    padding: 5px 6px;
    background: #f8f9fa;
    border-radius: 10px;
    font-size: 11px;
    border: 1px solid #3d85c6;
    line-height: 1.3;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
    z-index: 10000 !important;
}

.data-item strong {
    color: #3d85c6;
    font-size: 10px;
    display: block;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 500;
}

.update-info {
    font-size: 9px;
    color: #3d85c6;
    text-align: center;
    margin-top: 10px;
    padding: 6px;
    background: #f8f9fa;
    border-radius: 15px;
    border: 1px dashed #3d85c6;
    line-height: 1.2;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
}

.loading {
    text-align: center;
    color: #3d85c6;
    font-style: italic;
    padding: 15px;
    font-size: 11px;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
}

.error {
    color: #3d85c6;
    text-align: center;
    padding: 8px;
    background: #f8f9fa;
    border-radius: 10px;
    font-size: 11px;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
    border: 1px solid #3d85c6;
}

.popup-content {
    max-width: 100%;
    border-radius: 15px;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
}

.popup-content h3 {
    font-size: 14px;
    margin: 0 0 8px 0;
    color: #3d85c6;
    line-height: 1.2;
    border-radius: 15px;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 500;
}

.popup-content p {
    font-size: 11px;
    margin: 0 0 10px 0;
    line-height: 1.3;
    color: #3d85c6;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
}

/* Анимация обновления */
@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
}

.updating {
    animation: pulse 2s infinite;
}

/* Дополнительные стили для тонких шрифтов */
.mapboxgl-popup-close-button {
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
}

/* Улучшенная читаемость тонких шрифтов */
.data-item, .update-info, .loading, .error {
    letter-spacing: 0.02em;
}

/* Стили для popup поверх всех элементов */
.top-popup {
    z-index: 10000 !important;
}

.mapboxgl-popup.top-popup {
    z-index: 10000 !important;
}

.mapboxgl-popup-content.top-popup {
    z-index: 10001 !important;
}

/* Гарантируем фиксированную ширину на всех устройствах */
@media (max-width: 768px) {
    .mapboxgl-popup {
        max-width: 250px !important;
        min-width: 250px !important;
        width: 250px !important;
    }
    
    .mapboxgl-popup-content {
        max-width: 250px !important;
        min-width: 250px !important;
        width: 250px !important;
    }
}












/* Делаем стрелочку неотъемлемой частью popup */
.mapboxgl-popup-tip {
    z-index: 10010 !important;
    pointer-events: none !important; /* Чтобы не мешала кликам */
}

/* Или скрыть маркеры когда открыт popup */
.mapboxgl-popup:not(.mapboxgl-popup-hover) ~ .mapboxgl-marker {
    opacity: 0.7 !important; /* Затемнить маркеры под popup */
}



</style>


<div id="map"></div>





<pre id="info"></pre>


<h2 id="location-title"></h2>
       
         <p id="location-description"></p>

<div class="calculation-box">







<p>EMIIA.AI API: JSON DATASET OUTPUT ❯<br>EMIIA.AI SIP: [<strong><span </span>AI WMS</strong>] ID R: [#3D4581] 

<span class="highlight1"></span></p>





<script>



    mapboxgl.accessToken = 'YOUR_MAPBOX_ACCESS_TOKEN';

    const map = new mapboxgl.Map({
        container: 'map', // container id
        // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
        style: 'https://sos.emiia.ai/style.json',
              zoom: 16,

      
        minZoom: 14,
        maxZoom: 21,


        center: [37.63546406, 55.83737711],
 
         
        hash: true,
        turn: false,
         
        attributionControl: false,
        


        bearing: 0, // bearing in degrees

pitch: 45,



        
	antialias: true // create the gl context with MSAA antialiasing, so custom layers are antialiased
         
    });












var geojson = {
  'type': 'FeatureCollection',
  'features': [
    {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [37.63147405, 55.83441285]
      },
      'properties': {
        'title': 'ВкусВилл STORE #21',
        'description': 'EMIIA.AI API: JSON DATASET OUTPUT ❯ EMIIA.AI SIP: ВкусВилл ID R: [#3D4581] <br> ВкусВилл #21'
      }
    }
  ]
};

// add markers to map
geojson.features.forEach(function (marker) {
  // create a HTML element for each feature
  var el = document.createElement('div');
  el.className = 'marker';

  // make a marker for each feature and add it to the map
  var markerObj = new mapboxgl.Marker(el)
    .setLngLat(marker.geometry.coordinates)
    .setPopup(
      new mapboxgl.Popup({ offset: 25 })
        .setHTML(
          '<h3>' +
            marker.properties.title +
            '</h3><p>' +
            marker.properties.description +
            '</p>'
        )
    )
    .addTo(map);

  // Функция для плавного показа/скрытия маркера в зависимости от зума
  function updateMarkerVisibility() {
    var zoom = map.getZoom();
    var opacity = Math.max(0, Math.min(1, (17 - zoom) / 2));
    
    el.style.opacity = opacity;
    
    if (zoom >= 17) {
      el.style.display = 'none';
    } else {
      el.style.display = 'block';
    }
  }

  // Слушаем событие изменения зума
  map.on('zoom', updateMarkerVisibility);

  // Проверяем видимость при загрузке
  updateMarkerVisibility();
});








var geojson = {
  'type': 'FeatureCollection',
  'features': [
    {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [37.63563151,55.83852133]
      },
      'properties': {
        'title': 'ВКУСВИЛЛ <br>DARK STORE #33',
        'description': 'EMIIA.AI API: JSON DATASET OUTPUT ❯ EMIIA.AI SIP: ВкусВилл ID R: [#3D4581] <br> ВкусВилл Dark Store #33'
      }
    }
  ]
};

// add markers to map
geojson.features.forEach(function (marker) {
  // create a HTML element for each feature
  var el = document.createElement('div');
  el.className = 'marker1';

  // make a marker for each feature and add it to the map
  var markerObj = new mapboxgl.Marker(el)
    .setLngLat(marker.geometry.coordinates)
    .setPopup(
      new mapboxgl.Popup({ offset: 25 }) // add popups
        .setHTML(
          '<h3>' +
            marker.properties.title +
            '</h3><p>' +
            marker.properties.description +
            '</p>'
        )
    )
    .addTo(map);

  // Функция для плавного показа/скрытия маркера в зависимости от зума
  function updateMarkerVisibility() {
    var zoom = map.getZoom();
    var opacity = Math.max(0, Math.min(1, (17 - zoom) / 2));
    
    el.style.opacity = opacity;
    
    if (zoom >= 17) {
      el.style.display = 'none';
    } else {
      el.style.display = 'block';
    }
  }

  // Слушаем событие изменения зума
  map.on('zoom', updateMarkerVisibility);

  // Проверяем видимость при загрузке
  updateMarkerVisibility();
});


















 


  map.on('load', () => {
        map.setPaintProperty('building', 'fill-color', [
            'interpolate',
            // Set the exponential rate of change to 0.5
            ['exponential', 1],
            ['zoom'],
            // When zoom is 15, buildings will be beige.
            15,
            'red',
            // When zoom is 18 or higher, buildings will be yellow.
            18,
            'red'
        ]);

        map.setPaintProperty('building', 'fill-opacity', [
            'interpolate',
            // Set the exponential rate of change to 0.5
            ['exponential', 1],
            ['zoom'],
            // When zoom is 10, buildings will be 100% transparent.
            10,
            0.5,
            // When zoom is 18 or higher, buildings will be 100% opaque.
            18,
            1
        ]);
    });








  










map.on('style.load', () => {
        // set the light preset to be in dusk mode.
        map.setConfigProperty('basemap', 'lightPreset', 'dusk');

        // add a geojson source with a polygon to be used in the clip layer.
        map.addSource('eraser', {
            'type': 'geojson',
            'data': {
                'type': 'FeatureCollection',
                'features': [
                    {
                        'type': 'Feature',
                        'properties': {},
                        'geometry': {
                            'coordinates': [
                                [
                                    [
            37.63138653415112,
            55.83397767687967
          ],
          [
            37.631323474598645,
            55.83401161180973
          ],
          [
            37.63138506034616,
            55.834039583692146
          ],
          [
            37.63144337877924,
            55.83400424627024
          ],
          [
            37.63138653415112,
            55.83397767687967
          ]
                                ]
                            ],
                            'type': 'Polygon'
                        }
                    }
                ]
            }
        });





















// Создаем универсальную пульсирующую SVG иконку с настраиваемым размером и частотой
const createPulsingSVGIcon = (svgPath, baseSize = 70, pulseDuration = 1600) => {
    return {
        width: 250,
        height: 250,
        data: new Uint8Array(250 * 250 * 4),

        onAdd: function () {
            const canvas = document.createElement('canvas');
            canvas.width = this.width;
            canvas.height = this.height;
            this.context = canvas.getContext('2d', { willReadFrequently: true });
            
            // Загружаем SVG изображение
            this.img = new Image();
            this.img.src = 'data:image/svg+xml;charset=utf-8,' + 
                encodeURIComponent(svgPath);
        },

        render: function () {
            const duration = pulseDuration;
            const t = (performance.now() % duration) / duration;
            const context = this.context;

            context.clearRect(0, 0, this.width, this.height);

            const centerX = this.width / 2;
            const centerY = this.height / 2;
            
            // Пульсация размера
            const scale = 0.9 + 0.1 * Math.sin(t * Math.PI * 2);
            const opacity = 0.8 + 0.2 * Math.sin(t * Math.PI * 2);

            // Размер иконки (базовый размер + пульсация)
            const iconSize = baseSize * scale;

            // Рисуем SVG иконку
            if (this.img.complete) {
                context.save();
                context.globalAlpha = opacity;
                context.drawImage(
                    this.img, 
                    centerX - iconSize / 2, 
                    centerY - iconSize / 2, 
                    iconSize, 
                    iconSize
                );
                context.restore();
            }

            this.data = context.getImageData(0, 0, this.width, this.height).data;
            map.triggerRepaint();

            return true;
        }
    };
};

// SVG для первого знака (восклицательный знак)
const svgExclamation = `
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-octagon" viewBox="0 0 16 16">
  <path  fill="#dc3545" d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1z"/>
  <path  fill="#dc3545" d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
</svg>
`;

// SVG для второго знака (энергия/молния)
const svgEnergy = `
<svg fill="#000000" width="800px" height="800px" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
  <path fill="#dc3545" d="M595.344 64.72h.176-.176zm0 0l-72.207 379.377 261.584.88L428.657 959.28l72.208-417.376-261.568-.912zm.049-63.999c-1.728 0-3.455.063-5.151.19-11.296.913-18.785 4.689-27.664 10.657a64.304 64.304 0 0 0-13.392 11.936 56.688 56.688 0 0 0-3.297 4.288L187.281 502.4c-14.16 19.408-16.24 45.025-5.36 66.433 10.864 21.408 32.832 34.976 56.912 35.152l184.736 1.344-58.08 342.192c-5.52 29.408 10.16 58.72 37.76 70.528a64.19 64.19 0 0 0 25.391 5.216c20.112 0 36.64-9.408 49.041-26.4L836.737 482.56c14.16-19.409 16.225-45.057 5.36-66.433-10.864-21.408-32.832-34.977-56.912-35.152l-184.736-.32 57.456-300.88a62.46 62.46 0 0 0 1.825-15.056c0-34.624-27.569-62.848-62.065-63.968-.767-.032-1.52-.032-2.271-.032z"/>
</svg>
`;



// SVG для второго знака (ТЕРМОМЕТР и ВЛАЖНОСТЬ в двух рядах)
const svgThermometer = `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="36" viewBox="0 0 32 36">
    <!-- ВЕРХНИЙ РЯД -->
    <!-- Термометр (слева сверху) -->
    <g transform="translate(0, 0)">
        <path fill="#dc3545" d="M9.5 12.5a1.5 1.5 0 1 1-2-1.415V2.5a.5.5 0 0 1 1 0v8.585a1.5 1.5 0 0 1 1 1.415"/>
        <path fill="#dc3545" d="M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1"/>
    </g>
    
    <!-- Влажность (справа сверху) -->
    <g transform="translate(16, 0)">
        <path fill="#dc3545" d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a29 29 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a29 29 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001zm0 0-.364-.343zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267"/>
    </g>

    
    
    <!-- Влажность (справа снизу) -->
    <g transform="translate(9, 20)">



  <path fill="#dc3545" d="M8 0a1 1 0 0 1 1 1v1.402c0 .511.677.693.933.25l.7-1.214a1 1 0 0 1 1.733 1l-.701 1.214c-.256.443.24.939.683.683l1.214-.701a1 1 0 0 1 1 1.732l-1.214.701c-.443.256-.262.933.25.933H15a1 1 0 1 1 0 2h-1.402c-.512 0-.693.677-.25.933l1.214.701a1 1 0 1 1-1 1.732l-1.214-.7c-.443-.257-.939.24-.683.682l.701 1.214a1 1 0 1 1-1.732 1l-.701-1.214c-.256-.443-.933-.262-.933.25V15a1 1 0 1 1-2 0v-1.402c0-.512-.677-.693-.933-.25l-.701 1.214a1 1 0 0 1-1.732-1l.7-1.214c.257-.443-.24-.939-.682-.683l-1.214.701a1 1 0 1 1-1-1.732l1.214-.701c.443-.256.261-.933-.25-.933H1a1 1 0 1 1 0-2h1.402c.511 0 .693-.677.25-.933l-1.214-.701a1 1 0 1 1 1-1.732l1.214.701c.443.256.939-.24.683-.683l-.701-1.214a1 1 0 0 1 1.732-1l.701 1.214c.256.443.933.261.933-.25V1a1 1 0 0 1 1-1m2 5a1 1 0 1 0-2 0 1 1 0 0 0 2 0M6 7a1 1 0 1 0-2 0 1 1 0 0 0 2 0m1 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m5-3a1 1 0 1 0-2 0 1 1 0 0 0 2 0"/>





    </g>
</svg>`;














// Создаем пульсирующие иконки для всех трех знаков с РАЗНЫМИ размерами и частотами
const exclamationPulsing = createPulsingSVGIcon(svgExclamation, 60, 2000);   // Первый знак: размер 60, медленная пульсация (2000ms)
const energyPulsing = createPulsingSVGIcon(svgEnergy, 80, 1400);             // Второй знак: размер 80, быстрая пульсация (1000ms)
const thermometerPulsing = createPulsingSVGIcon(svgThermometer, 120, 1600);   // Третий знак: размер 70, средняя пульсация (1600ms)

// Добавляем пульсирующие версии
map.addImage('exclamation-pulsing', exclamationPulsing, { pixelRatio: 2 });
map.addImage('energy-pulsing', energyPulsing, { pixelRatio: 2 });
map.addImage('thermometer-pulsing', thermometerPulsing, { pixelRatio: 2 });

// Создаем источники для знаков
map.addSource('point-1', {
    'type': 'geojson',
    'data': {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': [37.63570024, 55.83845765]
                },
                'properties': {
                    'title': 'ВКУСВИЛЛ <br>DARK STORE #33',
                    'description': 'EMIIA.AI API: ID R: [#3D4582]'
                }
            }
        ]
    }
});

map.addSource('point-2', {
    'type': 'geojson',
    'data': {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': [37.63572517,55.83859092]
                },
                'properties': {
                    'title': 'ВКУСВИЛЛ <br>DARK STORE #33',
                    'description': 'EMIIA.AI API: ID R: [#3D4583]'
                }
            }
        ]
    }
});

map.addSource('point-3', {
    'type': 'geojson',
    'data': {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': [37.63572125,55.83852512]
                },
                'properties': {
                    'title': 'ВКУСВИЛЛ <br>DARK STORE #33',
                    'description': 'EMIIA.AI API: ID R: [#3D4584]'
                }
            }
        ]
    }
});

// Добавляем слои для всех трех знаков с SVG иконками
map.addLayer({
    'id': 'layer-1',
    'type': 'symbol',
    'source': 'point-1',
    'minzoom': 18,
    'layout': {
        'icon-image': 'exclamation-pulsing',
        'icon-offset': [0, 0],
        'icon-allow-overlap': true,
        'icon-ignore-placement': true
    }
});

map.addLayer({
    'id': 'layer-2',
    'type': 'symbol',
    'source': 'point-2',
    'minzoom': 18,
    'layout': {
        'icon-image': 'energy-pulsing',
        'icon-offset': [0, 0],
        'icon-allow-overlap': true,
        'icon-ignore-placement': true
    }
});

map.addLayer({
    'id': 'layer-3',
    'type': 'symbol',
    'source': 'point-3',
    'minzoom': 18,
    'layout': {
        'icon-image': 'thermometer-pulsing',
        'icon-offset': [0, 0],
        'icon-allow-overlap': true,
        'icon-ignore-placement': true
    }
});

// Создаем popup для знаков
const exclamationPopup = new mapboxgl.Popup({ 
    offset: 25,
    className: 'top-popup',
    maxWidth: '400px'
});

// HTML для первого знака
const redLinesHTML1 = `
<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
    <div style="color: #ff0000; font-size: 14px; margin-bottom: 8px;">
        Нарушение промышленной безопасности.
    </div>
    <div style="color: #ff0000; font-size: 14px;">
        <a href="https://www.emiia.ai/" 
           target="_blank" 
           style="color: #ff0000; text-decoration: none;">
            ОТЧЁТ ❯
        </a>
    </div>
</div>
`;

// HTML для второго знака
const redLinesHTML2 = `
<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
    <div style="color: #ff0000; font-size: 14px; margin-bottom: 8px;">
        Перегрев электропроводки. 
    </div>
    <div style="color: #ff0000; font-size: 14px;">
        <a href="https://www.emiia.ai/" 
           target="_blank" 
           style="color: #ff0000; text-decoration: none;">
            ОТЧЁТ ❯
        </a>
    </div>
</div>
`;

// HTML для третьего знака
const redLinesHTML3 = `
<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
    <div style="color: #ff0000; font-size: 14px; margin-bottom: 8px;">
        • Нарушен температурный режим<br>
        • Нарушен микроклимат<br>
        • Выявлены загрязнители воздуха
    </div>
    <div style="color: #ff0000; font-size: 14px;">
        <a href="https://www.emiia.ai/" 
           target="_blank" 
           style="color: #ff0000; text-decoration: none;">
          ОТЧЁТ ❯
        </a>
    </div>
</div>
`;

// Обработчики клика по знакам
map.on('click', 'layer-1', function(e) {
    const coordinates = e.features[0].geometry.coordinates.slice();
    const description = e.features[0].properties.description;
    const title = e.features[0].properties.title;
    
    exclamationPopup
        .setLngLat(coordinates)
        .setHTML(
            '<h3>' + title + '</h3><p>' + description + '</p>' + redLinesHTML1
        )
        .addTo(map);
});

map.on('click', 'layer-2', function(e) {
    const coordinates = e.features[0].geometry.coordinates.slice();
    const description = e.features[0].properties.description;
    const title = e.features[0].properties.title;
    
    exclamationPopup
        .setLngLat(coordinates)
        .setHTML(
            '<h3>' + title + '</h3><p>' + description + '</p>' + redLinesHTML2
        )
        .addTo(map);
});

map.on('click', 'layer-3', function(e) {
    const coordinates = e.features[0].geometry.coordinates.slice();
    const description = e.features[0].properties.description;
    const title = e.features[0].properties.title;
    
    exclamationPopup
        .setLngLat(coordinates)
        .setHTML(
            '<h3>' + title + '</h3><p>' + description + '</p>' + redLinesHTML3
        )
        .addTo(map);
});

// Обработчики для показа курсора при наведении
map.on('mouseenter', 'layer-1', function() {
    map.getCanvas().style.cursor = 'pointer';
});

map.on('mouseleave', 'layer-1', function() {
    map.getCanvas().style.cursor = '';
});

map.on('mouseenter', 'layer-2', function() {
    map.getCanvas().style.cursor = 'pointer';
});

map.on('mouseleave', 'layer-2', function() {
    map.getCanvas().style.cursor = '';
});

map.on('mouseenter', 'layer-3', function() {
    map.getCanvas().style.cursor = 'pointer';
});

map.on('mouseleave', 'layer-3', function() {
    map.getCanvas().style.cursor = '';
});

























const size = 180;

// Первая точка (зеленая) - оригинальная
const pulsingDot = {
    width: size,
    height: size,
    data: new Uint8Array(size * size * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const duration = 1800;
        const pulseDuration = 700;
        const t = (performance.now() % duration) / duration;
        const pulseT = (performance.now() % pulseDuration) / pulseDuration;
        const context = this.context;

        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const maxRadius = size / 2 * 1;
        const sweepAngle = Math.PI * 2 * 1.7 * t;
        const opacity = 0.8 * Math.pow(1 - t, 2);

        context.beginPath();
        context.moveTo(centerX, centerY);
        context.arc(centerX, centerY, maxRadius, Math.PI / 2, sweepAngle + Math.PI / 2);
        context.closePath();

        context.fillStyle = `rgba(45, 190, 100, ${opacity})`;
        context.fill();

        const radius = (size / 2) * 0.35;
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = 'rgba(144, 238, 144, 1)';
        context.strokeStyle = '#f8f9fa';

        context.lineWidth = 4 + 4 * Math.abs(Math.sin(Math.PI * pulseT));
        context.fill();
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        map.triggerRepaint();

        return true;
    }
};

// Вторая точка (оранжевая)
const pulsingDotOrange = {
    width: size,
    height: size,
    data: new Uint8Array(size * size * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const duration = 1500;
        const pulseDuration = 700;
        const t = (performance.now() % duration) / duration;
        const pulseT = (performance.now() % pulseDuration) / pulseDuration;
        const context = this.context;

        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const maxRadius = size / 2 * 1;
        const sweepAngle = Math.PI * 2 * 1.7 * t;
        const opacity = 0.8 * Math.pow(1 - t, 2);

        context.beginPath();
        context.moveTo(centerX, centerY);
        context.arc(centerX, centerY, maxRadius, Math.PI / 2, sweepAngle + Math.PI / 2);
        context.closePath();

        context.fillStyle = `rgba(255, 165, 0, ${opacity})`; // Оранжевый цвет
        context.fill();

        const radius = (size / 2) * 0.35;
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = 'rgba(255, 200, 100, 1)'; // Светло-оранжевый
        context.strokeStyle = '#f8f9fa';

        context.lineWidth = 4 + 4 * Math.abs(Math.sin(Math.PI * pulseT));
        context.fill();
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        map.triggerRepaint();

        return true;
    }
};

// Создаем изображение для красной точки (остановка)
const redDot = {
    width: 40,
    height: 40,
    data: new Uint8Array(40 * 40 * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const context = this.context;
        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const radius = 15;

        // Внешнее свечение
        const gradient = context.createRadialGradient(centerX, centerY, radius, centerX, centerY, radius + 5);
        gradient.addColorStop(0, 'rgba(255, 0, 0, 0.8)');
        gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');

        context.beginPath();
        context.arc(centerX, centerY, radius + 5, 0, Math.PI * 2);
        context.fillStyle = gradient;
        context.fill();

        // Основная точка
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = '#e06666';
        context.fill();

        // Белая обводка
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.strokeStyle = '#ffffff';
        context.lineWidth = 3;
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        return true;
    }
};

// Создаем изображение для оранжевой точки остановки
const orangeDot = {
    width: 40,
    height: 40,
    data: new Uint8Array(40 * 40 * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const context = this.context;
        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const radius = 15;

        // Внешнее свечение
        const gradient = context.createRadialGradient(centerX, centerY, radius, centerX, centerY, radius + 5);
        gradient.addColorStop(0, 'rgba(255, 165, 0, 0.8)'); // Оранжевый цвет
        gradient.addColorStop(1, 'rgba(255, 165, 0, 0)');

        context.beginPath();
        context.arc(centerX, centerY, radius + 5, 0, Math.PI * 2);
        context.fillStyle = gradient;
        context.fill();

        // Основная точка
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = '#ffa500'; // Оранжевый
        context.fill();

        // Белая обводка
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.strokeStyle = '#ffffff';
        context.lineWidth = 3;
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        return true;
    }
};

// Создаем изображение для серой точки (пройденная остановка)
const grayDot = {
    width: 40,
    height: 40,
    data: new Uint8Array(40 * 40 * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const context = this.context;
        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const radius = 12;

        // Основная точка
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = '#b9ea21';
        context.fill();

        // Белая обводка
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.strokeStyle = '#ffffff';
        context.lineWidth = 2;
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        return true;
    }
};

// Создаем изображение для серой оранжевой точки (пройденная остановка оранжевой точки)
const grayOrangeDot = {
    width: 40,
    height: 40,
    data: new Uint8Array(40 * 40 * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const context = this.context;
        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const radius = 12;

        // Основная точка
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = '#cccc00'; // Желто-серый для оранжевой точки
        context.fill();

        // Белая обводка
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.strokeStyle = '#ffffff';
        context.lineWidth = 2;
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        return true;
    }
};

// Координаты для первой точки (зеленая)
const coordinates1 = [
    [37.63585261,55.83839169],
    [37.63583652,55.83837213],
    [37.63594252,55.83834578],
    [37.63598143,55.8383977],
    [37.63563796,55.83848348], // ЧЕТВЕРТАЯ
    [37.63556925,55.83850933],
    [37.63559508,55.83854435],
    [37.63564159,55.83860005],
    [37.63585585,55.83854527],
    [37.63605058,55.83849579],
    [37.63598143,55.8383977],
    [37.63594252,55.83834578],
    [37.63585261,55.83839169]
];

// Координаты для второй точки (оранжевая)
const coordinates2 = [
    [37.63573089, 55.83832215],
    [37.63543959, 55.83839318],
    [37.63551033, 55.83847803], // ТОЧКА ОСТАНОВКИ (индекс 2)
    [37.63553685,55.83851043], // ТОЧКА ИЗГИБА
    [37.63563796,55.83848348], // ТОЧКА ТОВАРА И ОСТАНОВКИ (индекс 4)
    [37.63553685,55.83851043], // ТОЧКА ИЗГИБА
    [37.63543959, 55.83839318],
    [37.63573089, 55.83832215]
];

// Определяем точки остановок для первой точки
const stopPoints1 = [4, 8];
const finalDestination1 = coordinates1.length - 1;

// Определяем точки остановок для второй точки (две остановки)
const stopPoints2 = [2, 4]; // Остановки на 2-й и 4-й точках
const finalDestination2 = coordinates2.length - 1;

// Массивы для отслеживания пройденных остановок
const completedStops1 = new Set();
const completedStops2 = new Set();

// Текущие цели маршрутов
let currentTargetIndex1 = 0;
let currentTargetIndex2 = 0;

// Функции для получения следующей цели маршрута
function getNextTarget1() {
    for (let stop of stopPoints1) {
        if (!completedStops1.has(stop)) {
            return stop;
        }
    }
    return finalDestination1;
}

function getNextTarget2() {
    for (let stop of stopPoints2) {
        if (!completedStops2.has(stop)) {
            return stop;
        }
    }
    return finalDestination2;
}

// Функция для сброса точек остановок для первой точки
function resetStopPoints1() {
    completedStops1.clear();
    currentTargetIndex1 = getNextTarget1();
    
    const stopFeatures = stopPoints1.map(index => ({
        'type': 'Feature',
        'geometry': {
            'type': 'Point',
            'coordinates': coordinates1[index]
        },
        'properties': {
            'index': index,
            'isCompleted': false
        }
    }));
    
    map.getSource('stop-points-1').setData({
        'type': 'FeatureCollection',
        'features': stopFeatures
    });
}

// Функция для сброса точек остановок для второй точки
function resetStopPoints2() {
    completedStops2.clear();
    currentTargetIndex2 = getNextTarget2();
    
    const stopFeatures = stopPoints2.map(index => ({
        'type': 'Feature',
        'geometry': {
            'type': 'Point',
            'coordinates': coordinates2[index]
        },
        'properties': {
            'index': index,
            'isCompleted': false
        }
    }));
    
    map.getSource('stop-points-2').setData({
        'type': 'FeatureCollection',
        'features': stopFeatures
    });
}

// Функции для принудительного обновления слоев точек остановок
function refreshStopPointsLayer1() {
    if (map.getLayer('stop-points-layer-1')) {
        map.removeLayer('stop-points-layer-1');
    }
    
    map.addLayer({
        'id': 'stop-points-layer-1',
        'type': 'symbol',
        'source': 'stop-points-1',
        'minzoom': 20,
        'layout': {
            'icon-image': ['case',
                ['==', ['get', 'isCompleted'], true], 'gray-dot',
                'red-dot'
            ],
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, 'layer-with-pulsing-dot-1');
}

function refreshStopPointsLayer2() {
    if (map.getLayer('stop-points-layer-2')) {
        map.removeLayer('stop-points-layer-2');
    }
    
    map.addLayer({
        'id': 'stop-points-layer-2',
        'type': 'symbol',
        'source': 'stop-points-2',
        'minzoom': 20,
        'layout': {
            'icon-image': ['case',
                ['==', ['get', 'isCompleted'], true], 'gray-dot',
                'red-dot'
            ],
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, 'layer-with-pulsing-dot-2');
}

// Функции для данных ISS и popup
async function fetchISSData() {
    try {
        const response = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Ошибка получения данных ISS:', error);
        return null;
    }
}

function getCurrentDate() {
    return new Date().toLocaleDateString('ru-RU', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
    });
}

function formatISSData(issData) {
    if (!issData) return '<div class="error">Данные не доступны</div>';
    
    return `
        <div class="iss-data">
            <h3>ВкусВилл Dark Store: #33</h3>
            <div class="data-grid">
                <div class="data-item">
                    <strong>Широта:</strong> ${issData.latitude ? issData.latitude.toFixed(4) : 'N/A'}°
                </div>
                <div class="data-item">
                    <strong>Долгота:</strong> ${issData.longitude ? issData.longitude.toFixed(4) : 'N/A'}°
                </div>
                <div class="data-item">
                    <strong>Высота:</strong> ${issData.altitude ? '1' + issData.altitude.toFixed(2) : 'N/A'} см
                </div>
                <div class="data-item">
                    <strong>Скорость:</strong> ${issData.velocity ? issData.velocity.toFixed(2).replace(/(\d)(?=\d{4,})/, '$1,').replace('.', ',') : 'N/A'} км/ч
                </div>
                <div class="data-item">
                    <strong>Видимость:</strong> ${issData.visibility || 'N/A'}
                </div>
                <div class="data-item">
                    <strong>Обновлено:</strong> ${new Date().toLocaleTimeString('ru-RU') + '.' + new Date().getMilliseconds().toString().padStart(3, '0')}
                </div>
                <div class="data-item">
                    <strong>Дата:</strong> ${getCurrentDate()}
                </div>
            </div>
            <div class="update-info">
                Автообновление каждые 5 ms
            </div>
        </div>
    `;
}

// Создаем popup для точек
let pointPopup1 = null;
let pointPopup2 = null;
let updateInterval1 = null;
let updateInterval2 = null;

// Функции для обновления данных в popup
async function updatePopupData1() {
    const issData = await fetchISSData();
    if (pointPopup1 && pointPopup1.isOpen()) {
        pointPopup1.setHTML(`
            <div class="popup-content">
                <h3>EMIIA.AI SIP: API DATASET <br>Сотрудник: ID D [#353837]</h3>
                <p>EMIIA.AI API: JSON DATASET OUTPUT ❯ EMIIA.AI SIP: ВкусВилл ID R: [#3D4581]</p>
                ${formatISSData(issData)}
            </div>
        `);
    }
}

async function updatePopupData2() {
    const issData = await fetchISSData();
    if (pointPopup2 && pointPopup2.isOpen()) {
        pointPopup2.setHTML(`
            <div class="popup-content">
                <h3>EMIIA.AI SIP: API DATASET <br>Робот: ID D [#309945]</h3>
                <p>EMIIA.AI API: JSON DATASET OUTPUT ❯ EMIIA.AI SIP: ВкусВилл ID R: [#FFA500]</p>
                ${formatISSData(issData)}
            </div>
        `);
    }
}

map.on('load', () => {
    // Устанавливаем 3D-наклон карты для эффекта поднятия
    map.setPitch(45);
    map.setBearing(0);

    // Добавляем источники для ПРОЙДЕННОГО пути (серый) для обеих точек
    map.addSource('passed-route-1', {
        'type': 'geojson',
        'data': {
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': []
            }
        }
    });

    map.addSource('passed-route-2', {
        'type': 'geojson',
        'data': {
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': []
            }
        }
    });

    // Добавляем источники для ПРЕДСТОЯЩЕГО пути (зеленый) для обеих точек
    map.addSource('future-route-1', {
        'type': 'geojson',
        'data': {
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': []
            }
        }
    });

    map.addSource('future-route-2', {
        'type': 'geojson',
        'data': {
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': []
            }
        }
    });

    // СНАЧАЛА добавляем слои пройденного пути (серый)
    map.addLayer({
        'id': 'passed-route-line-1',
        'type': 'line',
        'source': 'passed-route-1',
        'minzoom': 20,
        'layout': {
            'line-join': 'round',
            'line-cap': 'round'
        },
        'paint': {
            'line-color': '#9ae894',
            'line-width': 8,
            'line-opacity': 0.3
        }
    }, '3d-buildings');

    map.addLayer({
        'id': 'passed-route-line-2',
        'type': 'line',
        'source': 'passed-route-2',
        'minzoom': 20,
        'layout': {
            'line-join': 'round',
            'line-cap': 'round'
        },
        'paint': {
            'line-color': '#ffb366',
            'line-width': 8,
            'line-opacity': 0.2
        }
    }, 'passed-route-line-1');

    // Добавляем слои предстоящего пути (зеленый и оранжевый)
    map.addLayer({
        'id': 'future-route-line-1',
        'type': 'line',
        'source': 'future-route-1',
        'minzoom': 20,
        'layout': {
            'line-join': 'round',
            'line-cap': 'round'
        },
        'paint': {
            'line-color': '#9ae894',
            'line-width': 8,
            'line-opacity': 1
        }
    }, 'passed-route-line-2');

    map.addLayer({
        'id': 'future-route-line-2',
        'type': 'line',
        'source': 'future-route-2',
        'minzoom': 20,
        'layout': {
            'line-join': 'round',
            'line-cap': 'round'
        },
        'paint': {
            'line-color': '#ffb366', // Оранжевый цвет для второй линии
            'line-width': 8,
            'line-opacity': 1
        }
    }, 'future-route-line-1');

    // Добавляем изображения точек
    map.addImage('pulsing-dot', pulsingDot, { pixelRatio: 4 });
    map.addImage('pulsing-dot-orange', pulsingDotOrange, { pixelRatio: 4 });
    map.addImage('red-dot', redDot, { pixelRatio: 2 });
    map.addImage('orange-dot', orangeDot, { pixelRatio: 2 });
    map.addImage('gray-dot', grayDot, { pixelRatio: 2 });
    map.addImage('gray-orange-dot', grayOrangeDot, { pixelRatio: 2 });

    // Источники для движущихся точек
    map.addSource('dot-point-1', {
        'type': 'geojson',
        'data': {
            'type': 'FeatureCollection',
            'features': [
                {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Point',
                        'coordinates': coordinates1[0]
                    }
                }
            ]
        }
    });

    map.addSource('dot-point-2', {
        'type': 'geojson',
        'data': {
            'type': 'FeatureCollection',
            'features': [
                {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Point',
                        'coordinates': coordinates2[0]
                    }
                }
            ]
        }
    });

    // Источники для точек остановок
    map.addSource('stop-points-1', {
        'type': 'geojson',
        'data': {
            'type': 'FeatureCollection',
            'features': stopPoints1.map(index => ({
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': coordinates1[index]
                },
                'properties': {
                    'index': index,
                    'isCompleted': false
                }
            }))
        }
    });

    map.addSource('stop-points-2', {
        'type': 'geojson',
        'data': {
            'type': 'FeatureCollection',
            'features': stopPoints2.map(index => ({
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': coordinates2[index]
                },
                'properties': {
                    'index': index,
                    'isCompleted': false
                }
            }))
        }
    });

    // СНАЧАЛА добавляем слои точек остановок
    map.addLayer({
        'id': 'stop-points-layer-1',
        'type': 'symbol',
        'source': 'stop-points-1',
        'minzoom': 20,
        'layout': {
            'icon-image': ['case',
                ['==', ['get', 'isCompleted'], true], 'gray-dot',
                'red-dot'
            ],
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, '3d-buildings');

    map.addLayer({
        'id': 'stop-points-layer-2',
        'type': 'symbol',
        'source': 'stop-points-2',
        'minzoom': 20,
        'layout': {
            'icon-image': ['case',
                ['==', ['get', 'isCompleted'], true], 'gray-dot',
                'red-dot'
            ],
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, 'stop-points-layer-1');

    // ПОТОМ добавляем слои движущихся точек
    map.addLayer({
        'id': 'layer-with-pulsing-dot-1',
        'type': 'symbol',
        'source': 'dot-point-1',
        'minzoom': 18,
        'layout': {
            'icon-image': 'pulsing-dot',
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, 'stop-points-layer-2');

    map.addLayer({
        'id': 'layer-with-pulsing-dot-2',
        'type': 'symbol',
        'source': 'dot-point-2',
        'minzoom': 18,
        'layout': {
            'icon-image': 'pulsing-dot-orange',
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, 'layer-with-pulsing-dot-1');

    // Создаем popup для точек
    pointPopup1 = new mapboxgl.Popup({ 
        offset: 25,
        className: 'top-popup',
        maxWidth: '400px'
    });

    pointPopup2 = new mapboxgl.Popup({ 
        offset: 25,
        className: 'top-popup',
        maxWidth: '400px'
    });

    // Обработчики клика по движущимся точкам
    map.on('click', 'layer-with-pulsing-dot-1', function(e) {
        const coordinates = e.features[0].geometry.coordinates.slice();
        
        updatePopupData1();
        updateInterval1 = setInterval(updatePopupData1, 500);
        
        pointPopup1
            .setLngLat(coordinates)
            .setHTML(`
                <div class="popup-content">
                    <h3>EMIIA.AI SIP: API DATASET <br> Сотрудник:</h3>
                    <p>EMIIA.AI API: JSON DATASET OUTPUT ❯ EMIIA.AI SIP: ВкусВилл ID R: [#3D4581]</p>
                    <div class="loading">Загрузка данных EMIIA.AI SIP: API...</div>
                </div>
            `)
            .addTo(map);
    });

    map.on('click', 'layer-with-pulsing-dot-2', function(e) {
        const coordinates = e.features[0].geometry.coordinates.slice();
        
        updatePopupData2();
        updateInterval2 = setInterval(updatePopupData2, 500);
        
        pointPopup2
            .setLngLat(coordinates)
            .setHTML(`
                <div class="popup-content">
                    <h3>EMIIA.AI SIP: API DATASET <br> Робот:</h3>
                    <p>EMIIA.AI API: JSON DATASET OUTPUT ❯ EMIIA.AI SIP: ВкусВилл ID R: [#FFA500]</p>
                    <div class="loading">Загрузка данных EMIIA.AI SIP: API...</div>
                </div>
            `)
            .addTo(map);
    });

    // Останавливаем обновление при закрытии popup
    pointPopup1.on('close', function() {
        if (updateInterval1) {
            clearInterval(updateInterval1);
            updateInterval1 = null;
        }
    });

    pointPopup2.on('close', function() {
        if (updateInterval2) {
            clearInterval(updateInterval2);
            updateInterval2 = null;
        }
    });

    // Инициализируем первые цели
    currentTargetIndex1 = getNextTarget1();
    currentTargetIndex2 = getNextTarget2();







    // Анимация перемещения точек и линий
    let currentIndex1 = 0;
    let currentIndex2 = 0;
    const duration = 8000;

    function animatePoint1() {
        const nextIndex = (currentIndex1 + 1) % coordinates1.length;
        const startCoord = coordinates1[currentIndex1];
        const endCoord = coordinates1[nextIndex];
        const startTime = performance.now();

        if (nextIndex === 0) {
            resetStopPoints1();
            setTimeout(refreshStopPointsLayer1, 100);
        }

        function animate(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const lng = startCoord[0] + (endCoord[0] - startCoord[0]) * progress;
            const lat = startCoord[1] + (endCoord[1] - startCoord[1]) * progress;
            const currentPoint = [lng, lat];
            
            // СНАЧАЛА обновляем точку (рендерится МЕДЛЕННЕЕ на мобильном)
            map.getSource('dot-point-1').setData({
                'type': 'FeatureCollection',
                'features': [
                    {
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Point',
                            'coordinates': currentPoint
                        }
                    }
                ]
            });

            // Микро-задержка для синхронизации на мобильных
            setTimeout(() => {
                // ПОТОМ обновляем пути (рендерятся БЫСТРЕЕ)
                const passedCoords = coordinates1.slice(0, currentIndex1 + 1);
                passedCoords.push(currentPoint);
                
                const futureCoords = [currentPoint];
                let targetReached = false;
                
                for (let i = currentIndex1 + 1; i < coordinates1.length && !targetReached; i++) {
                    futureCoords.push(coordinates1[i]);
                    if (i === currentTargetIndex1) targetReached = true;
                }
                
                if (!targetReached) {
                    for (let i = 0; i <= currentTargetIndex1 && !targetReached; i++) {
                        futureCoords.push(coordinates1[i]);
                        if (i === currentTargetIndex1) targetReached = true;
                    }
                }
                
                map.getSource('passed-route-1').setData({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'LineString',
                        'coordinates': passedCoords
                    }
                });
                
                map.getSource('future-route-1').setData({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'LineString',
                        'coordinates': futureCoords
                    }
                });

                // Принудительно триггерим ререндер карты
                map.triggerRepaint();
            }, 16); // ~1 кадр

            if (stopPoints1.includes(currentIndex1) && !completedStops1.has(currentIndex1)) {
                completedStops1.add(currentIndex1);
                currentTargetIndex1 = getNextTarget1();
                
                const stopFeatures = stopPoints1.map(index => ({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Point',
                        'coordinates': coordinates1[index]
                    },
                    'properties': {
                        'index': index,
                        'isCompleted': completedStops1.has(index)
                    }
                }));
                
                map.getSource('stop-points-1').setData({
                    'type': 'FeatureCollection',
                    'features': stopFeatures
                });

                setTimeout(refreshStopPointsLayer1, 50);
            }

            if (pointPopup1 && pointPopup1.isOpen()) {
                pointPopup1.setLngLat(currentPoint);
            }

            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                currentIndex1 = nextIndex;
                setTimeout(() => {
                    requestAnimationFrame(animatePoint1);
                }, 500);
            }
        }

        requestAnimationFrame(animate);
    }

    function animatePoint2() {
        const nextIndex = (currentIndex2 + 1) % coordinates2.length;
        const startCoord = coordinates2[currentIndex2];
        const endCoord = coordinates2[nextIndex];
        const startTime = performance.now();

        if (nextIndex === 0) {
            resetStopPoints2();
            setTimeout(refreshStopPointsLayer2, 100);
        }

        function animate(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const lng = startCoord[0] + (endCoord[0] - startCoord[0]) * progress;
            const lat = startCoord[1] + (endCoord[1] - startCoord[1]) * progress;
            const currentPoint = [lng, lat];
            
            // СНАЧАЛА обновляем точку (рендерится МЕДЛЕННЕЕ на мобильном)
            map.getSource('dot-point-2').setData({
                'type': 'FeatureCollection',
                'features': [
                    {
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Point',
                            'coordinates': currentPoint
                        }
                    }
                ]
            });

            // Микро-задержка для синхронизации на мобильных
            setTimeout(() => {
                // ПОТОМ обновляем пути (рендерятся БЫСТРЕЕ)
                const passedCoords = coordinates2.slice(0, currentIndex2 + 1);
                passedCoords.push(currentPoint);
                
                const futureCoords = [currentPoint];
                let targetReached = false;
                
                for (let i = currentIndex2 + 1; i < coordinates2.length && !targetReached; i++) {
                    futureCoords.push(coordinates2[i]);
                    if (i === currentTargetIndex2) targetReached = true;
                }
                
                if (!targetReached) {
                    for (let i = 0; i <= currentTargetIndex2 && !targetReached; i++) {
                        futureCoords.push(coordinates2[i]);
                        if (i === currentTargetIndex2) targetReached = true;
                    }
                }
                
                map.getSource('passed-route-2').setData({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'LineString',
                        'coordinates': passedCoords
                    }
                });
                
                map.getSource('future-route-2').setData({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'LineString',
                        'coordinates': futureCoords
                    }
                });

                // Принудительно триггерим ререндер карты
                map.triggerRepaint();
            }, 16); // ~1 кадр

            if (stopPoints2.includes(currentIndex2) && !completedStops2.has(currentIndex2)) {
                completedStops2.add(currentIndex2);
                currentTargetIndex2 = getNextTarget2();
                
                const stopFeatures = stopPoints2.map(index => ({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Point',
                        'coordinates': coordinates2[index]
                    },
                    'properties': {
                        'index': index,
                        'isCompleted': completedStops2.has(index)
                    }
                }));
                
                map.getSource('stop-points-2').setData({
                    'type': 'FeatureCollection',
                    'features': stopFeatures
                });

                setTimeout(refreshStopPointsLayer2, 50);
            }

            if (pointPopup2 && pointPopup2.isOpen()) {
                pointPopup2.setLngLat(currentPoint);
            }

            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                currentIndex2 = nextIndex;
                setTimeout(() => {
                    requestAnimationFrame(animatePoint2);
                }, 500);
            }
        }

        requestAnimationFrame(animate);
    }

    // Запускаем анимацию обеих точек
    setTimeout(() => {
        requestAnimationFrame(animatePoint1);
    }, 6000);
    
    setTimeout(() => {
        requestAnimationFrame(animatePoint2);
    }, 1000);
});








// Добавляем пятого источника для нового GLB-файла ласточка-тест
        map.addSource('model5', {
            'type': 'geojson',
            'data': {
                'type': 'Feature',
                'properties': {
                    'model-uri':
                        ''
                },
                'geometry': {
                    'coordinates': [37.631367826980494,
            55.833906458903954],
                    'type': 'Point'
                }
            }
        });


        // add the clip layer and configure it to also remove symbols and trees.
        // clip-layer-scope layout property is used to specify that only models from the Mapbox Standard Style should be clipped.
        // this will prevent the newly added model from getting clipped.
        map.addLayer({
            'id': 'eraser',
            'type': 'clip',
            'source': 'eraser',
            'layout': {
                // specify the layer types to be removed by this clip layer
                'clip-layer-types': ['symbol', 'model'],
                'clip-layer-scope': ['basemap']
            }
        });

        // add the model layer and specify the appropriate slot to ensure the symbols are rendered correctly.
        



    map.addLayer({
        'id': 'tower5',
        'type': 'model',
        'slot': 'middle',
        'source': 'model5',
        'minzoom': 15,
        'maxzoom': 21,
        'layout': {
            'model-id': ['get', 'model-uri']
        },
        'paint': {
            'model-opacity': ['interpolate', ['linear'], ['zoom'], 15, 1, 21, 0],
            'model-rotation': [0.0, 0.0, 4.0],
            'model-scale': [1.5, 1.5, 1.5],
'model-translation': [0, 0, 4], // ЗДЕСЬ: поднятие на 10 единиц по Z
            'model-color-mix-intensity': 0,
            'model-cast-shadows': true,

            'model-emissive-strength': 0.3
        }
    });


















// Добавляем четвертый источник для нового GLB-файла нижний
map.addSource('model4', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH_verh_GLB.glb' // Замените на URL второго GLB
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094], // Другие координаты
            'type': 'Point'
        }
    }
});






map.addLayer({
    'id': 'tower4',
    'type': 'model',
    'slot': 'middle',
    'source': 'model4',
    'minzoom': 15,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],



17, 0,    // Полная прозрачность (0%) на зуме 17
            18, 0.1, // Средняя прозрачность (50%) на зуме 17.75
18.5, 0.9, // Средняя прозрачность (50%) на зуме 17.75
            19, 1,  // 90% прозрачности (90%) на зуме 18.5
19.5, 1  // 90% прозрачности (90%) на зуме 18.5



    
        ],
        




        'model-rotation': [0.0, 0.0, -761.5],
      


'model-scale': [999.5, 1090.0, 1000],

        'model-translation': [0, 0, 0.001], // ЗДЕСЬ: поднятие на 10 единиц по Z
        'model-color-mix-intensity': 1,
        'model-cast-shadows': true,


        'model-emissive-strength': 0.9



    }
});



























// Добавляем второй источник для нового GLB-файла верхний
map.addSource('model2', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH_verh_GLB.glb' // Замените на URL второго GLB
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094], // Другие координаты
            'type': 'Point'
        }
    }
});






map.addLayer({
    'id': 'tower2',
    'type': 'model',
    'slot': 'middle',
    'source': 'model2',
    'minzoom': 15,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },



    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],
            17, 0,    // Полная прозрачность (0%) на зуме 17
            18, 0.1, // Средняя прозрачность (50%) на зуме 17.75
18.5, 0.9, // Средняя прозрачность (50%) на зуме 17.75
            19, 1,  // 90% прозрачности (90%) на зуме 18.5
19.5, 1  // 90% прозрачности (90%) на зуме 18.5
        ],

        'model-rotation': [0.0, 0.0, -761.5],
        'model-scale': [999.5, 1090.0, 100],
        'model-color-mix-intensity': 1,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 6.3],
        'model-emissive-strength': 0.9



    }
});

























// Добавить источник GeoJSON с указанием модели зеленая модель
map.addSource('model1', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH_MINUS_GLB_TEST.glb'
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094],
            'type': 'Point'
        }
    }
});


// Добавить слой модели с плавным появлением
map.addLayer({
    'id': 'tower1',
    'type': 'model',
    'slot': 'middle',
    'source': 'model1',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


            18.3, 0,    // Полная прозрачность (0%) на зуме 17
            18.5, 0.5, // Средняя прозрачность (50%) на зуме 17.75
            18.6, 0.7,  // 90% прозрачности (90%) на зуме 18.5
19.5, 0.8  // 90% прозрачности (90%) на зуме 18.5


        ],


        'model-rotation': [0.0, 0.0, -761.5],
        'model-scale': [999.5, 1090.0, 1000],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 0.3],
        'model-emissive-strength': 0.99
    }
});










// Добавить источник GeoJSON с указанием модели ЗНАКИ ПОЖАРНЫЕ
map.addSource('model7', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH_BASE_GLB.glb'
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094],
            'type': 'Point'
        }
    }
});


// Добавить слой модели с плавным появлением
map.addLayer({
    'id': 'tower7',
    'type': 'model',
    'slot': 'middle',
    'source': 'model7',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


            18.3, 0,    // Полная прозрачность (0%) на зуме 17
            18.5, 0.4, // Средняя прозрачность (50%) на зуме 17.75
            18.6, 0.5,  // 90% прозрачности (90%) на зуме 18.5
19.5, 0.7,  // 90% прозрачности (90%) на зуме 18.5
20, 0.8,  // 90% прозрачности (90%) на зуме 18.5
21, 0.9,  // 90% прозрачности (90%) на зуме 18.5
22, 0.9,  // 90% прозрачности (90%) на зуме 18.5
24, 0.9  // 90% прозрачности (90%) на зуме 18.5


        ],


        'model-rotation': [0.0, 0.0, -761.5],
        'model-scale': [999.5, 1090.0, 1000],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 0.2],
        'model-emissive-strength': 0.99
    }
});













// Добавить источник GeoJSON с указанием модели ЗНАКИ ПОЖАРНЫЕ СТАТУС (ПОЛОМКА, ЗАМЕНА...)
map.addSource('model8', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH_FARE_1_GLB.glb'
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094],
            'type': 'Point'
        }
    }
});


// Добавить слой модели с плавным появлением
map.addLayer({
    'id': 'tower8',
    'type': 'model',
    'slot': 'middle',
    'source': 'model8',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


            18.3, 0,    // Полная прозрачность (0%) на зуме 17
            18.5, 0.4, // Средняя прозрачность (50%) на зуме 17.75
            18.6, 0.5,  // 90% прозрачности (90%) на зуме 18.5
19.5, 0.7,  // 90% прозрачности (90%) на зуме 18.5
20, 0.8,  // 90% прозрачности (90%) на зуме 18.5
21, 0.9,  // 90% прозрачности (90%) на зуме 18.5
22, 0.9,  // 90% прозрачности (90%) на зуме 18.5
24, 0.9  // 90% прозрачности (90%) на зуме 18.5


        ],


        'model-rotation': [0.0, 0.0, -761.5],
        'model-scale': [999.5, 1090.0, 1000],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 0.2],
        'model-emissive-strength': 0.99
    }
});
















// Добавить источник GeoJSON с указанием модели главная модель
map.addSource('model', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH-GLB.glb'
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094],
            'type': 'Point'
        }
    }
});


// Добавить слой модели с плавным появлением
map.addLayer({
    'id': 'tower',
    'type': 'model',
    'slot': 'middle',
    'source': 'model',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


            18.3, 0,    // Полная прозрачность (0%) на зуме 17
            18.5, 0.4, // Средняя прозрачность (50%) на зуме 17.75
            18.6, 0.5,  // 90% прозрачности (90%) на зуме 18.5
19.5, 0.7,  // 90% прозрачности (90%) на зуме 18.5
20, 0.8,  // 90% прозрачности (90%) на зуме 18.5
21, 0.9,  // 90% прозрачности (90%) на зуме 18.5
22, 0.9,  // 90% прозрачности (90%) на зуме 18.5
24, 0.9  // 90% прозрачности (90%) на зуме 18.5


        ],


        'model-rotation': [0.0, 0.0, -761.5],
        'model-scale': [999.5, 1090.0, 1000],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 0.2],
        'model-emissive-strength': 0.99
    }
});


















// Добавить источник GeoJSON с указанием модели ВКУСВИЛЛ товар
map.addSource('model23', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VV_ZONE_GLB.glb'
        },
        'geometry': {
            'coordinates': [37.63576835,55.83837975],
            'type': 'Point'
        }
    }
});


// Добавить слой модели с плавным появлением
map.addLayer({
    'id': 'tower23',
    'type': 'model',
    'slot': 'middle',
    'source': 'model23',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


        18.3, 0,    // Полная прозрачность (0%) на зуме 17
            18.5, 0.4, // Средняя прозрачность (50%) на зуме 17.75
            18.6, 0.5,  // 90% прозрачности (90%) на зуме 18.5
19.5, 0.7,  // 90% прозрачности (90%) на зуме 18.5
20, 1,  // 90% прозрачности (90%) на зуме 18.5
21, 1,  // 90% прозрачности (90%) на зуме 18.5
22, 1,  // 90% прозрачности (90%) на зуме 18.5
24, 1  // 90% прозрачности (90%) на зуме 18.5



        ],


       'model-rotation': [0, 0.0, -155.9],
        'model-scale': [1170.5, 1090.0, 1170],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 0.2],
        'model-emissive-strength': 0.5
    }
});

















// Добавить источник GeoJSON с указанием модели ВКУСВИЛЛ
map.addSource('model20', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VV_BASE_GLB.glb'
        },
        'geometry': {
            'coordinates': [37.63576835,55.83837975],
            'type': 'Point'
        }
    }
});


// Добавить слой модели с плавным появлением
map.addLayer({
    'id': 'tower20',
    'type': 'model',
    'slot': 'middle',
    'source': 'model20',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


        18.3, 0,    // Полная прозрачность (0%) на зуме 17
            18.5, 0.4, // Средняя прозрачность (50%) на зуме 17.75
            18.6, 0.5,  // 90% прозрачности (90%) на зуме 18.5
19.5, 0.7,  // 90% прозрачности (90%) на зуме 18.5
20, 0.7,  // 90% прозрачности (90%) на зуме 18.5
21, 0.7,  // 90% прозрачности (90%) на зуме 18.5
22, 0.7,  // 90% прозрачности (90%) на зуме 18.5
24, 0.7  // 90% прозрачности (90%) на зуме 18.5



        ],


        'model-rotation': [0, 0.0, -155.9],
        'model-scale': [1170.5, 1090.0, 1170],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 0.2],
        'model-emissive-strength': 0.99
    }
});











// Добавляем второй источник для нового GLB-файла верхний ВкусВилл
map.addSource('model21', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VV_VERH_GLB.glb' // Замените на URL второго GLB
        },
        'geometry': {
            'coordinates': [37.63576835,55.83837975], // Другие координаты
            'type': 'Point'
        }
    }
});






map.addLayer({
    'id': 'tower21',
    'type': 'model',
    'slot': 'middle',
    'source': 'model21',
    'minzoom': 15,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },



    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],
            17, 0,    // Полная прозрачность (0%) на зуме 17
            18, 0.1, // Средняя прозрачность (50%) на зуме 17.75
18.5, 0.9, // Средняя прозрачность (50%) на зуме 17.75
            19, 1,  // 90% прозрачности (90%) на зуме 18.5
19.5, 1  // 90% прозрачности (90%) на зуме 18.5
        ],

        'model-rotation': [0, 0.0, -155.9],
        'model-scale': [1170.5, 1090.0, 1170],
        'model-color-mix-intensity': 1,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 7.3],
        'model-emissive-strength': 0.9



    }
});











// Добавляем четвертый источник для нового GLB-файла нижний ВкусВилл
map.addSource('model22', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VV_VERH_GLB.glb' // Замените на URL второго GLB
        },
        'geometry': {
            'coordinates': [37.63576835,55.83837975], // Другие координаты
            'type': 'Point'
        }
    }
});






map.addLayer({
    'id': 'tower22',
    'type': 'model',
    'slot': 'middle',
    'source': 'model22',
    'minzoom': 15,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],



17, 0,    // Полная прозрачность (0%) на зуме 17
            18, 0.1, // Средняя прозрачность (50%) на зуме 17.75
18.5, 0.9, // Средняя прозрачность (50%) на зуме 17.75
            19, 1,  // 90% прозрачности (90%) на зуме 18.5
19.5, 1  // 90% прозрачности (90%) на зуме 18.5



    
        ],
        




        





'model-rotation': [0, 0.0, -155.9],
        'model-scale': [1170.5, 1090.0, 1170],




        'model-translation': [0, 0, 0.000], // ЗДЕСЬ: поднятие на 10 единиц по Z
        'model-color-mix-intensity': 1,
        'model-cast-shadows': true,


        'model-emissive-strength': 0.9



    }
});

























}); // Закрывающая скобка















  


















      
      
      
map.on('load', () => {
    const layers = map.getStyle().layers;
    let labelLayerId;
    for (let i = 0; i < layers.length; i++) {
        if (layers[i].type === 'symbol' && layers[i].layout['text-field']) {
            labelLayerId = layers[i].id;
            break;
        }
    }

    map.addSource('openmaptiles', {
        url: 'https://sos.emiia.ai/tiles.json',
        type: 'vector',
    });

    map.addLayer({
        'id': '3d-buildings',
        'source': 'openmaptiles',
        'source-layer': 'building',
        'type': 'fill-extrusion',
        'minzoom': 14,
        'maxzoom': 19,
        'paint': {
            'fill-extrusion-color': [
                'interpolate',
                ['linear'],
                ['get', 'render_height'],
                1, 'lightgray',
                200, '#6d9eeb',
                400, 'white'
            ],
            'fill-extrusion-height': [
                'interpolate',
                ['linear'],
                ['zoom'],
                14, 0, // Высота 0 при зуме 14
                15.5, ['get', 'render_height'] // Полная высота при зуме 15.5
            ],
            'fill-extrusion-base': [
                'case',
                ['>=', ['get', 'zoom'], 16.5],
                ['get', 'render_min_height'],
                0
            ],
            'fill-extrusion-opacity': [
                'interpolate',
                ['linear'],
                ['zoom'],
                14, 0, // Полностью прозрачно при зуме 14
                15.5, 0.5, // Максимальная прозрачность (0.5) при зуме 15.5
                18, 0 // Полностью прозрачно при зуме 18
            ]
        }
    }, labelLayerId);
});







map.on('load', () => {
    map.addSource('polygon-source', {
        type: 'geojson',
        data: {
            type: 'Feature',
            geometry: {
                type: 'Polygon',
                coordinates: [[
                    [37.174014825136595, 55.97747637225763],
                    [37.174223117007614, 55.97745607738463],
                    [37.17408018404612, 55.97699461722809],
                    [37.173873474273904, 55.977014791684724],
                    [37.174014825136595, 55.97747637225763]
                ]]
            },
            properties: {
                height: 6.9 // высота экструзии (над базой)
            }
        }
    });

    map.addLayer({
        id: 'extruded-polygon',
        type: 'fill-extrusion',
        source: 'polygon-source',
        paint: {
            'fill-extrusion-color': '#0047AB',
            'fill-extrusion-height': ['get', 'height'],
            'fill-extrusion-base': 3.85,
          


        'fill-extrusion-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],
           




17.9, 0.007,

18.0, 0.009,
 
18.1, 0.2, 



        ],







            'fill-extrusion-ambient-occlusion-intensity': 0 // минимизирует тени
        }
    });


// Отключение теней
    map.setLight({
        intensity: 0.5// Полностью убирает тени
    });

});


















map.on('load', () => {
    map.addSource('polygon-source1', {
        type: 'geojson',
        data: {
            type: 'Feature',
            geometry: {
                type: 'Polygon',
                coordinates: [[
                    [37.174014825136595, 55.97747637225763],
                    [37.174223117007614, 55.97745607738463],
                    [37.17408018404612, 55.97699461722809],
                    [37.173873474273904, 55.977014791684724],
                    [37.174014825136595, 55.97747637225763]
                ]]
            },
            properties: {
                height: 3.95 // высота экструзии (над базой)
            }
        }
    });

    map.addLayer({
        id: 'extruded-polygon1',
        type: 'fill-extrusion',
        source: 'polygon-source1',
        paint: {
            'fill-extrusion-color': '#0047AB',
            'fill-extrusion-height': ['get', 'height'],
            'fill-extrusion-base': 3.95,
            'fill-extrusion-opacity': 0.2,


            'fill-extrusion-ambient-occlusion-intensity': 0.1 // минимизирует тени
        }
    }, '3d-buildings');




});











// ПЕРЕКРЫВАЕМ ПАРКОВКУ
map.on('load', () => {
    // Добавляем источник с полигоном
    map.addSource('overlay-polygon', {
        type: 'geojson',
        data: {
            type: 'Feature',
            geometry: {
                type: 'Polygon',
                coordinates: [[
                    [37.63125656186148, 55.83383282373481],
                    [37.631067152172164, 55.83395371999572],
                    [37.63152632128711, 55.834180149472445],
                    [37.63171740706366, 55.83406258752953],
                    [37.63125656186148, 55.83383282373481]
                ]]
            },
            properties: {
                height: 0.01 // Высота перекрытия (можно регулировать)
            }
        }
    });

    // Добавляем слой с выдавливанием
    map.addLayer({
        id: 'polygon-overlay',
        type: 'fill-extrusion',
        source: 'overlay-polygon',
        paint: {
            'fill-extrusion-color': '#f3f3f3', // Белый цвет
            'fill-extrusion-height': ['get', 'height'],
            'fill-extrusion-base': 0,
            'fill-extrusion-opacity': 1, // Полная непрозрачность
            'fill-extrusion-ambient-occlusion-intensity': 0 // Без теней
        }
    }, '3d-buildings'); // Убедитесь, что это имя вашего слоя с 3D-зданиями
});













</script>























<script>


// ОЧЕНЬ ВАЖНЫЙ БЛОК

map.on('style.load', () => {
        map.addSource('mapbox-dem', {
            'type': 'raster-dem',
            'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
            'tileSize': 0,
            'maxzoom': 24
        });

        // add the DEM source as a terrain layer
        map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 0.0 });

 
 
// ВЫТАВЛЯЕМ ЗЕМЛЮ НА -1 









map.addSource('geojson', {
            'type': 'geojson',
            'lineMetrics': true,
            'data': {
                'type': 'Feature',
                'properties': {
                    // add an array of elevation values.
                    // the number of values doesn't need to match the number of coordinates.
                    'elevation': [
                        -4, 4, 5, 5.5, 4, 3, 0
                    ]
                },
                'geometry': {
                    'coordinates': [
                            [37.630907830210646, 55.8339924045205],
                            [37.6309770003019, 55.834026416653444],
                            [37.63102306010572, 55.83405016143769],
                            [37.63103528399293, 55.83401619712731]
                    ],
                    'type': 'LineString'
                }
            }
        });

        // add the elevated line layer

// Линию делаем 0
        map.addLayer({
            'id': 'elevated-line',
            'type': 'line',
            'source': 'geojson',
            'layout': {
                'line-z-offset': [
                    'at-interpolated',
                    [
                        '*',
                        ['line-progress'],
                        ['-', ['length', ['get', 'elevation']], 1]
                    ],
                    ['get', 'elevation']
                ],
                'line-elevation-reference': 'sea'
            },
            'paint': {
                'line-emissive-strength': 1.0,
                'line-width': 8.0,
                'line-color': 'royalblue'
            }
        });
    });























// бегущая линия

    const geojson = {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'properties': {},
                'geometry': {
                    'coordinates': [
                        

                           [37.63088726, 55.83399153],
                            [37.6309893,55.83404027],
                            [37.6309878,55.83406037],
                           [37.63098217,55.83407239],
                         
                            [37.63095,55.83411],
                            [37.63092323,55.83413374],
                            [37.63100719,55.83417627],
                            [37.63107888,55.83421063],
                            [37.63116048,55.83425289],
                            [37.6312313,55.83420817],
                            [37.63129053,55.83417114],
                            [37.6312401,55.8341485],

 [37.63112045,55.83408876],
 [37.63109693,55.83404414],
 [37.63103578,55.83401419]
                    ],
                    'type': 'LineString'
                }
            }
        ]
    };

    map.on('load', () => {
        map.addSource('line', {
            type: 'geojson',
            data: geojson
        });

        // add a line layer without line-dasharray defined to fill the gaps in the dashed line
        map.addLayer({
            type: 'line',
            source: 'line',

 'minzoom': 19,
        'maxzoom': 22,
            id: 'line-background',
            paint: {
                'line-color': '#c3ea4a',
                'line-width': 9,
                'line-opacity': 0.8
            }
        });

        // add a line layer with line-dasharray set to the first value in dashArraySequence
        map.addLayer({
            type: 'line',
            source: 'line',


 'minzoom': 19,
        'maxzoom': 24,


            id: 'line-dashed',
            paint: {
                'line-color': '#f8f9fa',
                'line-width': 6,
                'line-dasharray': [0, 4, 3],
                'line-emissive-strength': 1
            }
        });

        // technique based on https://jsfiddle.net/2mws8y3q/
        // an array of valid line-dasharray values, specifying the lengths of the alternating dashes and gaps that form the dash pattern
        const dashArraySequence = [
            [0, 4, 3],
            [0.5, 4, 2.5],
            [1, 4, 2],
            [1.5, 4, 1.5],
            [2, 4, 1],
            [2.5, 4, 0.5],
            [3, 4, 0],
            [0, 0.5, 3, 3.5],
            [0, 1, 3, 3],
            [0, 1.5, 3, 2.5],
            [0, 2, 3, 2],
            [0, 2.5, 3, 1.5],
            [0, 3, 3, 1],
            [0, 3.5, 3, 0.5]
        ];

        let step = 0;

        function animateDashArray(timestamp) {
            // Update line-dasharray using the next value in dashArraySequence. The
            // divisor in the expression `timestamp / 50` controls the animation speed.
            const newStep = parseInt(
                (timestamp / 50) % dashArraySequence.length
            );

            if (newStep !== step) {
                map.setPaintProperty(
                    'line-dashed',
                    'line-dasharray',
                    dashArraySequence[step]
                );
                step = newStep;
            }

            // Request the next frame of the animation.
            requestAnimationFrame(animateDashArray);
        }

        // start the animation
        animateDashArray(0);
    });

























</script>














 

       





<script>

map.on('mousemove', (e) => {
    // Функция для округления чисел в JSON до 5 знаков
    const roundToFive = (key, value) => {
        if (typeof value === 'number') {
            return parseFloat(value.toFixed(8));
        }
        return value;
    };

    const pointStr = JSON.stringify(e.point, roundToFive);
    const lngLatStr = JSON.stringify(e.lngLat.wrap(), roundToFive);

    document.getElementById('info').innerHTML = 
        `${pointStr}<br />${lngLatStr}`;
});
     

    </script>














<script>

class EnhancedBlurHandler {
    constructor() {
        this.isVisible = true;
        this.blurIntensity = 10;
        this.init();
    }

    init() {
        this.createBlurOverlay();
        this.setupEventListeners();
    }

    createBlurOverlay() {
        const overlay = document.createElement('div');
        overlay.id = 'blur-overlay';
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(0px);
            -webkit-backdrop-filter: blur(0px);
            background-color: rgba(255, 255, 255, 0);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 9999;
            opacity: 0;
        `;
        document.body.appendChild(overlay);
        this.overlay = overlay;
    }

    setupEventListeners() {
        // Page Visibility API
        document.addEventListener('visibilitychange', () => {
            this.handleVisibilityChange();
        });

        // Резервные события
        window.addEventListener('blur', () => this.handleBlur());
        window.addEventListener('focus', () => this.handleFocus());

        // Проверка поддержки
        this.checkBackdropFilterSupport();
    }

    handleVisibilityChange() {
        this.isVisible = !document.hidden;
        this.animateBlur();
    }

    handleBlur() {
        this.isVisible = false;
        this.animateBlur();
    }

    handleFocus() {
        this.isVisible = true;
        this.animateBlur();
    }

    animateBlur() {
        if (!this.isVisible) {
            this.overlay.style.backdropFilter = `blur(${this.blurIntensity}px)`;
            this.overlay.style.webkitBackdropFilter = `blur(${this.blurIntensity}px)`;
            this.overlay.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
            this.overlay.style.opacity = '1';
        } else {
            this.overlay.style.backdropFilter = 'blur(0px)';
            this.overlay.style.webkitBackdropFilter = 'blur(0px)';
            this.overlay.style.backgroundColor = 'rgba(255, 255, 255, 0)';
            this.overlay.style.opacity = '0';
        }
    }

    checkBackdropFilterSupport() {
        if (!CSS.supports('backdrop-filter', 'blur(10px)') && 
            !CSS.supports('-webkit-backdrop-filter', 'blur(10px)')) {
            console.warn('Backdrop-filter не поддерживается');
            // Можно добавить альтернативное решение
        }
    }

    // Метод для изменения интенсивности размытия
    setBlurIntensity(intensity) {
        this.blurIntensity = intensity;
        if (!this.isVisible) {
            this.animateBlur();
        }
    }
}

// Использование
const enhancedBlur = new EnhancedBlurHandler();

// Опционально: изменить интенсивность размытия
// enhancedBlur.setBlurIntensity(15);


 </script>



















<div class="header">
    <a class="header" href="javascript:void(0)" onclick="showPopup()" 
   style="display: inline-block; padding: 0px; border-radius: 20px; transition: all 0.2s ease;"
   onmouseover="this.style.background='rgba(61, 133, 198, 0.08)'; this.style.transform='scale(1.02)';"
   onmouseout="this.style.background='none'; this.style.transform='scale(1)';"
   ontouchstart="this.style.background='rgba(61, 133, 198, 0.08)'; this.style.transform='scale(0.98)';"
   ontouchend="this.style.background='none'; this.style.transform='scale(1)';">

        <svg xmlns="http://www.w3.org/2000/svg" width="75" height="75" viewBox="0 0 100 100" id="wave" data-name="Layer 1">
            <path id="Line_1" data-name="Line 1" fill="#3D85C6" stroke="#3D85C6" d="m49.244102 60.047245l0 0c-0.20874405 0 -0.3779602 -0.16921997 -0.3779602 -0.3779602l0 -19.33857c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874405 0 0.3779602 0.16921997 0.3779602 0.3779602l0 19.33857c0 0.20874023 -0.16921616 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_1" data-name="Line 1" fill="#3D85C6" stroke="#3D85C6" stroke-width="1.0" stroke-linejoin="round" stroke-linecap="butt" d="m49.244102 60.047245l0 0c-0.20874405 0 -0.3779602 -0.16921997 -0.3779602 -0.3779602l0 -19.33857c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874405 0 0.3779602 0.16921997 0.3779602 0.3779602l0 19.33857c0 0.20874023 -0.16921616 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_2" data-name="Line 2" fill="#3D85C6" stroke="#3D85C6" d="m41.362213 65.66929l0 0c-0.20874405 0 -0.3779602 -0.16921234 -0.3779602 -0.3779602l0 -30.58266c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874023 0 0.3779602 0.16921997 0.3779602 0.3779602l0 30.58266c0 0.20874786 -0.16921997 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_2" data-name="Line 2" fill="#3D85C6" stroke="#3D85C6" stroke-width="1.0" stroke-linejoin="round" stroke-linecap="butt" d="m41.362213 65.66929l0 0c-0.20874405 0 -0.3779602 -0.16921234 -0.3779602 -0.3779602l0 -30.58266c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874023 0 0.3779602 0.16921997 0.3779602 0.3779602l0 30.58266c0 0.20874786 -0.16921997 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_3" data-name="Line 3" fill="#3D85C6" stroke="#3D85C6" d="m33.480324 55.842518l0 0c-0.20874405 0 -0.3779602 -0.16921616 -0.3779602 -0.3779602l0 -10.929115c0 -0.100242615 0.03981781 -0.19638062 0.110702515 -0.2672615c0.07088089 -0.07088089 0.16701508 -0.1106987 0.2672577 -0.1106987l1.511795 0c0.20874023 0 0.3779602 0.16921616 0.3779602 0.3779602l0 10.929115l0 0c0 0.20874405 -0.16921997 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_3" data-name="Line 3" fill="#3D85C6" stroke="#3D85C6" stroke-width="1.0" stroke-linejoin="round" stroke-linecap="butt" d="m33.480324 55.842518l0 0c-0.20874405 0 -0.3779602 -0.16921616 -0.3779602 -0.3779602l0 -10.929115c0 -0.100242615 0.03981781 -0.19638062 0.110702515 -0.2672615c0.07088089 -0.07088089 0.16701508 -0.1106987 0.2672577 -0.1106987l1.511795 0c0.20874023 0 0.3779602 0.16921616 0.3779602 0.3779602l0 10.929115l0 0c0 0.20874405 -0.16921997 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_4" data-name="Line 4" fill="#3D85C6" stroke="#3D85C6" d="m57.12599 61.92126l0 0c-0.20874023 0 -0.3779602 -0.16921997 -0.3779602 -0.3779602l0 -23.086601c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874405 0 0.3779602 0.16921997 0.3779602 0.3779602l0 23.086601l0 0c0 0.20874023 -0.16921616 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_4" data-name="Line 4" fill="#3D85C6" stroke="#3D85C6" stroke-width="1.0" stroke-linejoin="round" stroke-linecap="butt" d="m57.12599 61.92126l0 0c-0.20874023 0 -0.3779602 -0.16921997 -0.3779602 -0.3779602l0 -23.086601c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874405 0 0.3779602 0.16921997 0.3779602 0.3779602l0 23.086601l0 0c0 0.20874023 -0.16921616 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_5" data-name="Line 5" fill="#3D85C6" stroke="#3D85C6" d="m65.00788 54.897636l0 0c-0.20874023 0 -0.3779602 -0.16921616 -0.3779602 -0.3779602l0 -9.039352c0 -0.100242615 0.03981781 -0.1963768 0.110702515 -0.2672577c0.070884705 -0.070884705 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874023 0 0.3779602 0.16921616 0.3779602 0.3779602l0 9.039352c0 0.20874405 -0.16921997 0.3779602 -0.3779602 0.3779602z"/>
            <path id="Line_5" data-name="Line 5" fill="#3D85C6" stroke="#3D85C6" stroke-width="1.0" stroke-linejoin="round" stroke-linecap="butt" d="m65.00788 54.897636l0 0c-0.20874023 0 -0.3779602 -0.16921616 -0.3779602 -0.3779602l0 -9.039352c0 -0.100242615 0.03981781 -0.1963768 0.110702515 -0.2672577c0.070884705 -0.070884705 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874023 0 0.3779602 0.16921616 0.3779602 0.3779602l0 9.039352c0 0.20874405 -0.16921997 0.3779602 -0.3779602 0.3779602z"/>
        </svg>
    </a>
</div>








<div id="popup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(5px); z-index: 10000; font-family: 'Montserrat', sans-serif; ">

    <div id="popup-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #f8f9fa; padding: 30px; border-radius: 36px; max-width: 400px; width: 85%; box-shadow: 0 10px 30px rgba(0,0,0,0.15); border: 0px solid #3D85C6; ">


        <h3 style="margin-top: 0; color: #3D85C6; font-family: 'Montserrat', sans-serif; font-weight: 500; font-size: 20px;">EMIIA.AI LLM: AI WMS <br><strong>DARK STORE #33</strong></h3>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 23px; margin-bottom: 25px; border: 1px solid #3D85C6; ">

            <p style="line-height: 2; color: #333; font-family: 'Montserrat', sans-serif; font-size: 14px; margin: 0;  font-weight: 400;">
                <strong style="color: #3D85C6;  font-weight: 400;">Мультиагентная система:</strong><br> <strong style="color: #3D85C6;  font-weight: 400;"> • ❯ EMIIA.AI IOT:</strong> <br>технический агент<br>

<strong style="color: #3D85C6; font-weight: 400;"> • ❯ EMIIA.AI OAI:</strong> <br>операционный агент<br>
<br>


<strong style="color: #3D85C6; font-weight: 400;">Субагенты:</strong><br>













<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16">
<!-- Контур (толстая обводка) -->
<path fill-rule="evenodd" 
        stroke="#3d85c6" 
        stroke-width="0.4" 
        fill="none"
        d="M2 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M0 2a2 2 0 0 1 3.937-.5h8.126A2 2 0 1 1 14.5 3.937v8.126a2 2 0 1 1-2.437 2.437H3.937A2 2 0 1 1 1.5 12.063V3.937A2 2 0 0 1 0 2m2.5 1.937v8.126c.703.18 1.256.734 1.437 1.437h8.126a2 2 0 0 1 1.437-1.437V3.937A2 2 0 0 1 12.063 2.5H3.937A2 2 0 0 1 2.5 3.937M14 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M2 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m12 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"/>

 <!-- Основная заливка -->
  <path fill-rule="evenodd" 
        fill="#3d85c6" 
        d="M2 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M0 2a2 2 0 0 1 3.937-.5h8.126A2 2 0 1 1 14.5 3.937v8.126a2 2 0 1 1-2.437 2.437H3.937A2 2 0 1 1 1.5 12.063V3.937A2 2 0 0 1 0 2m2.5 1.937v8.126c.703.18 1.256.734 1.437 1.437h8.126a2 2 0 0 1 1.437-1.437V3.937A2 2 0 0 1 12.063 2.5H3.937A2 2 0 0 1 2.5 3.937M14 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M2 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m12 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"/>

</svg> AI-МАППЕР <br> 














<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16">
  <!-- Контур (толстая обводка) -->
  <path fill-rule="evenodd" 
        stroke="#3d85c6" 
        stroke-width="0.4" 
        fill="none"
        d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5zM8.5 5a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5zM0 11.5A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm4.5.5A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm4.5.5a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z"/>
  
  <!-- Основная заливка -->
  <path fill-rule="evenodd" 
        fill="#3d85c6" 
        d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5zM8.5 5a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5zM0 11.5A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm4.5.5A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm4.5.5a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z"/>
</svg>  AI-КОННЕКТОР <br>


<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16">
  <!-- Контур (толстая обводка) -->
  <path fill-rule="evenodd" 
        stroke="#3d85c6" 
        stroke-width="0.4" 
        fill="none"
        d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.3 1.3 0 0 0-.37.265.3.3 0 0 0-.057.09V14l.002.008.016.033a.6.6 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.6.6 0 0 0 .146-.15l.015-.033L12 14v-.004a.3.3 0 0 0-.057-.09 1.3 1.3 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465s-2.462-.172-3.34-.465c-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411"/>
  
  <!-- Основная заливка -->
  <path fill-rule="evenodd" 
        fill="#3d85c6" 
        d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.3 1.3 0 0 0-.37.265.3.3 0 0 0-.057.09V14l.002.008.016.033a.6.6 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.6.6 0 0 0 .146-.15l.015-.033L12 14v-.004a.3.3 0 0 0-.057-.09 1.3 1.3 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465s-2.462-.172-3.34-.465c-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411"/>
</svg> AI-НАВИГАТОР <br>











<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16">
  <!-- Контур (толстая обводка) -->
<path fill-rule="evenodd" 
        stroke="#3d85c6" 
        stroke-width="0.4" 
        fill="none"
        d="M6 6.207v9.043a.75.75 0 0 0 1.5 0V10.5a.5.5 0 0 1 1 0v4.75a.75.75 0 0 0 1.5 0v-8.5a.25.25 0 1 1 .5 0v2.5a.75.75 0 0 0 1.5 0V6.5a3 3 0 0 0-3-3H6.236a1 1 0 0 1-.447-.106l-.33-.165A.83.83 0 0 1 5 2.488V.75a.75.75 0 0 0-1.5 0v2.083c0 .715.404 1.37 1.044 1.689L5.5 5c.32.32.5.754.5 1.207"/>


<path fill-rule="evenodd" 
        stroke="#3d85c6" 
        stroke-width="0.5" 
        fill="none"
        d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>
  
  
  <!-- Основная заливка -->
  <path fill-rule="evenodd" 
        fill="#3d85c6" 
        d="M6 6.207v9.043a.75.75 0 0 0 1.5 0V10.5a.5.5 0 0 1 1 0v4.75a.75.75 0 0 0 1.5 0v-8.5a.25.25 0 1 1 .5 0v2.5a.75.75 0 0 0 1.5 0V6.5a3 3 0 0 0-3-3H6.236a1 1 0 0 1-.447-.106l-.33-.165A.83.83 0 0 1 5 2.488V.75a.75.75 0 0 0-1.5 0v2.083c0 .715.404 1.37 1.044 1.689L5.5 5c.32.32.5.754.5 1.207"/>
 <path fill="#3d85c6" d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>


</svg> AI-СПАСАТЕЛЬ <br>












<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16">
  <!-- Контур (толстая обводка) -->
<path fill-rule="evenodd" 
        stroke="#3d85c6" 
        stroke-width="0.4" 
        fill="none"
        d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5z"/>
<path fill-rule="evenodd" 
        stroke="#3d85c6" 
        stroke-width="0.4" 
        fill="none"
        d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5z"/>
<path fill-rule="evenodd" 
        stroke="#3d85c6" 
        stroke-width="0.4" 
        fill="none"
        d="M10 7a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0zm-6 4a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0zm4-3a1 1 0 0 0-1 1v3a1 1 0 1 0 2 0V9a1 1 0 0 0-1-1"/>


<path fill-rule="evenodd" 
        stroke="#3d85c6" 
        stroke-width="0.5" 
        fill="none"
        d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>
  
  
  <!-- Основная заливка -->
  <path fill-rule="evenodd" 
        fill="#3d85c6" 
        d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5z"/>

 <path fill="#3d85c6" d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5z"/>

 <path fill="#3d85c6" d="M10 7a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0zm-6 4a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0zm4-3a1 1 0 0 0-1 1v3a1 1 0 1 0 2 0V9a1 1 0 0 0-1-1"/>


</svg> AI-АНАЛИТИК  <br> 








<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16">
<!-- Контур (толстая обводка) -->
<path fill-rule="evenodd" 
        stroke="#3d85c6" 
        stroke-width="0.4" 
        fill="none"
        d="M0 0h1v15h15v1H0zm14.817 11.887a.5.5 0 0 0 .07-.704l-4.5-5.5a.5.5 0 0 0-.74-.037L7.06 8.233 3.404 3.206a.5.5 0 0 0-.808.588l4 5.5a.5.5 0 0 0 .758.06l2.609-2.61 4.15 5.073a.5.5 0 0 0 .704.07"/>

 <!-- Основная заливка -->
  <path fill-rule="evenodd" 
        fill="#3d85c6" 
        d="M0 0h1v15h15v1H0zm14.817 11.887a.5.5 0 0 0 .07-.704l-4.5-5.5a.5.5 0 0 0-.74-.037L7.06 8.233 3.404 3.206a.5.5 0 0 0-.808.588l4 5.5a.5.5 0 0 0 .758.06l2.609-2.61 4.15 5.073a.5.5 0 0 0 .704.07"/>

</svg> AI-АУДИТОР<br>




            </p>
        </div>
        <button onclick="closePopup()" 
                style="background: #3D85C6; color: #f8f9fa; border: none; padding: 16px 32px; border-radius: 14px; cursor: pointer; width: 100%; font-family: 'Montserrat', sans-serif; font-weight: 600; font-size: 16px; transition: all 0.2s ease; transform: scale(1); min-height: 50px;"
                onmousedown="this.style.transform='scale(0.95)'; this.style.background='#2a6ba5';"
                onmouseup="this.style.transform='scale(1)'; this.style.background='#3D85C6';"
                onmouseleave="this.style.transform='scale(1)'; this.style.background='#3D85C6';"
                ontouchstart="this.style.transform='scale(0.95)'; this.style.background='#2a6ba5';"
                ontouchend="this.style.transform='scale(1)'; this.style.background='#3D85C6';">
            Закрыть
        </button>
    </div>
</div>





<script>
// Предварительная загрузка шрифта с поддержкой кириллицы
const fontLink = document.createElement('link');
fontLink.href = 'https://fonts.googleapis.com/css2?family=Montserrat:cyrillic,wght@0,400;0,500;0,600;1,400;1,500;1,600&display=swap';
fontLink.rel = 'stylesheet';
document.head.appendChild(fontLink);

// Ждем загрузки шрифта перед показом попапа
let fontLoaded = false;
const font = new FontFace('Montserrat', 'url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WlhyyTh89Y.woff2)');

font.load().then(function(loadedFont) {
    document.fonts.add(loadedFont);
    fontLoaded = true;
}).catch(function(error) {
    console.log('Font loading failed: ', error);
    fontLoaded = true; // Все равно показываем попап, даже если шрифт не загрузился
});

function showPopup() {
    // Если шрифт еще не загружен, ждем немного
    if (!fontLoaded) {
        setTimeout(showPopup, 100);
        return;
    }
    
    document.getElementById('popup').style.display = 'block';
    adjustForMobile();
}

function closePopup() {
    document.getElementById('popup').style.display = 'none';
}

document.getElementById('popup').addEventListener('click', function(e) {
    if (e.target === this) {
        closePopup();
    }
});

function adjustForMobile() {
    const content = document.getElementById('popup-content');
    
    if (window.innerWidth <= 768) {
        content.style.width = 'calc(100% - 80px)';
        content.style.maxWidth = '320px';
        content.style.padding = '25px';
    } else {
        content.style.width = '85%';
        content.style.maxWidth = '400px';
        content.style.padding = '30px';
    }
}

// Предварительная настройка для мобильных устройств
document.addEventListener('DOMContentLoaded', function() {
    adjustForMobile();
    
    // Предварительно создаем элементы для ускорения отображения
    const popup = document.getElementById('popup');
    popup.style.display = 'none'; // Гарантируем, что попап скрыт
});

window.addEventListener('resize', adjustForMobile);
</script>


























<style>
.loader {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
}
#wave path {
  fill: #818cf8;
  transform-origin: 50% 50%;
  animation: pulse 1s infinite;
}
#wave.stop path {
  animation-play-state: paused;
}

#wave #Line_1 { animation-delay: 0.0s; }
#wave #Line_2 { animation-delay: 0.15s; }
#wave #Line_3 { animation-delay: 0.3s; }
#wave #Line_4 { animation-delay: 0.45s; }
#wave #Line_5 { animation-delay: 0.6s; }


@keyframes pulse {
  0%   { transform: scaleY(1);}
  50%  { transform: scaleY(0.7);}
  100% { transform: scaleY(1);}
}



/* Десктоп по умолчанию */
textarea::placeholder {
    color: #E2E8F0 !important;
}

/* Мобильная версия */
@media (max-width: 640px) {
    textarea::placeholder {
        color: #E2E8F0 !important; /* Пример другого цвета для мобилок */
    }





</style>




<style>
.calculation-box {
height: 30px;
width: 300px;
position: absolute;
bottom: 43px;
left: 18px;
background-color: transparent;
padding: 9.5px;

font-family: 'Montserrat', montserrat !important; 
}
 
p {
font-family: 'Montserrat';
margin: 0px;
font-size: 10px;
color: #3d85c6;
}

.calculation-box p:not(:last-child) {
    margin-bottom: 10px; /* Применяется ко всем <p>, кроме последнего */
}

.highlight {
    font-size: 18px; /* Увеличьте значение по необходимости, например, 18px */
font-weight: 500; /* Жирность (700 = bold, 800 или 900 — ещё жирнее) */
}

.highlight1 {
    position: relative;
    top: 3px; /* Опускает стрелку на 3px вниз, измените значение по необходимости */
font-size: 18px; /* Увеличьте значение по необходимости, например, 18px */
}

</style>


















<style>
@import url('https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

	<style>
@import url('https://www.emiia.ru/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

  <style>  
@import url('/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

<link rel="stylesheet" href="https://www.emiia.ru/cssfamily=Montserrat.css">
<link rel="stylesheet" href="/cssfamily=Montserrat.css">









 




</div>
</div>




</body>
</html>


