<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>–ü–†–û–°–¢–†–ê–ù–°–¢–í–ï–ù–ù–´–ô –ò–ù–¢–ï–õ–õ–ï–ö–¢</title>

    <!-- PWA Meta -->
    <meta name="theme-color" content="#f8f9fa">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EMIIA.AI">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-167x167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">
    
    <link rel="shortcut icon" href="/vv.ico" type="image/x-icon">
    <link rel="manifest" href="/vv.webmanifest">

    <!-- –°–æ—Ü—Å–µ—Ç–∏ -->
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="/vv.html"/>
    <meta property="og:title" content="EMIIA.AI SIP"/>
    <meta property="og:image" content="/vvjpg.jpg"/>
    <meta name="twitter:card" content="summary_large_image"/>

    <!-- –ü–†–ï–î–ó–ê–ì–†–£–ó–ö–ê -->
    <link rel="preload" href="/telegram-web-app.js" as="script">
    <link rel="preload" href="/logo_wms.svg" as="image">

    <!-- –°–¢–ò–õ–ò -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { 
            background-color: #F8F9FA;
            height: 100%;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #F8F9FA;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        
        .main-container {
            width: 100%;
            max-width: 100%;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .auth-container {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        h2 {
            color: #da4216;
            margin: 0 0 1.5rem 0;
            text-align: center;
            font-size: 1.8rem;
        }
        
        .input-group {
            margin-bottom: 1.2rem;
        }
        
        input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color .3s ease;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            letter-spacing: 2px;
        }
        
        input:focus {
            outline: none;
            border-color: #6d9eeb;
            box-shadow: 0 0 0 3px rgba(52,152,219,.1);
        }
        
        button {
            width: 100%;
            padding: 14px;
            background: #6d9eeb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background .3s ease;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin-top: .5rem;
        }
        
        button:hover {
            background: #3c78d8;
        }
        
        .notification-btn {
            background: #27ae60 !important;
            margin-top: 10px !important;
        }
        
        .notification-btn:hover {
            background: #219a52 !important;
        }
        
        .badge-btn {
            background: #ff3b30 !important;
            margin-top: 5px !important;
        }
        
        .badge-btn:hover {
            background: #d70015 !important;
        }
        
        .desktop-btn {
            background: #9b59b6 !important;
            margin-top: 5px !important;
        }
        
        .desktop-btn:hover {
            background: #8e44ad !important;
        }
        
        .text-primary {
            color: #6d9eeb;
            text-decoration: none;
        }
        
        .notification-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #e9ecef;
        }
        
        .badge-display {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
        }
        
        .badge-counter {
            display: inline-block;
            background: #ff3b30;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .status-message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .platform-info {
            font-size: 0.8rem;
            color: #6c757d;
            text-align: center;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 15px;
                align-items: flex-start;
                padding-top: max(20px, env(safe-area-inset-top));
            }
            
            .auth-container {
                padding: 1.5rem;
                margin: 0;
                max-width: 100%;
                width: 100%;
            }
        }
        
        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        @media (prefers-color-scheme: dark) {
            .auth-container {
                background: #1a1a1a;
                color: white;
            }
            
            input {
                background: #2d2d2d;
                border-color: #404040;
                color: white;
            }
            
            input:focus {
                border-color: #6d9eeb;
            }
            
            .notification-panel {
                background: #2d2d2d;
                border-color: #404040;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="auth-container">
            <div class="header-wrapper">
                <h2>
                    <a class="text-primary1" href="https://www.emiia.ru/">                    
                        <img src="/logo_wms.svg" alt="AI WMS" width="230" height="75" loading="eager">
                    </a>
                </h2>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º -->
            <div class="notification-panel">
                <h3 style="margin-bottom: 15px; color: #333; text-align: center;">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                
                <div id="notificationStatus" class="status-message status-info">
                    –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...
                </div>
                
                <div class="badge-display">
                    <strong>–¢–µ–∫—É—â–∏–π –±–µ–π–¥–∂: </strong>
                    <span id="currentBadge" class="badge-counter">0</span>
                </div>
                
                <button class="notification-btn" id="testNotificationBtn">
                    üîî –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                </button>
                
                <button class="badge-btn" id="addBadgeBtn">
                    üî¥ +1 –∫ –±–µ–π–¥–∂—É
                </button>
                
                <button class="badge-btn" id="clearBadgeBtn">
                    üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –±–µ–π–¥–∂
                </button>
                
                <button class="desktop-btn" id="testDesktopBtn">
                    üíª –¢–µ—Å—Ç Windows/Mac
                </button>
                
                <div id="platformInfo" class="platform-info">
                    –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã...
                </div>
            </div>

            <form id="auth-form">
                <div class="input-group">
                    <input type="text" id="login" name="username" placeholder="Email address" autocomplete="username" required>
                </div>
                <div class="input-group">
                    <input type="password" id="password" name="password" placeholder="Password" autocomplete="current-password" required>
                </div>
                <p class="small"><a class="text-primary" href="mailto:emiia@emiia.ai">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a></p>

                <button type="submit">–í–û–ô–¢–ò <span>‚ùØ</span></button>
            </form>

            <p style="margin-top:1rem">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a class="text-primary" href="mailto:emiia@emiia.ai">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
            
            <div style="text-align:center;margin-top:2rem">
                <a class="text-primary1" href="https://www.emiia.ru/" style="color:#da4216;font-weight:600;text-decoration:none">
                    <span style="color:#b2b4b3;font-size:1rem;font-weight:500">–ü–†–û–°–¢–†–ê–ù–°–¢–í–ï–ù–ù–´–ô –ò–ù–¢–ï–õ–õ–ï–ö–¢</span>
                    <span style="font-size:1rem;font-weight:600;color:#3c78d8;margin-left:2px"> ‚Ä¢ ‚ùØ</span>
                </a>
            </div>
        </div>
    </div>

    <script>
        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
        class UniversalNotificationManager {
            constructor() {
                this.badgeCount = parseInt(localStorage.getItem('badgeCount')) || 0;
                this.platform = this.detectPlatform();
                this.supportsBadges = false;
                this.supportsNotifications = false;
                this.initialize();
            }

            detectPlatform() {
                const userAgent = navigator.userAgent.toLowerCase();
                let platform = 'unknown';
                
                if (userAgent.includes('windows')) platform = 'windows';
                else if (userAgent.includes('macintosh') || userAgent.includes('mac os')) platform = 'macos';
                else if (userAgent.includes('iphone') || userAgent.includes('ipad')) platform = 'ios';
                else if (userAgent.includes('android')) platform = 'android';
                else if (userAgent.includes('linux')) platform = 'linux';
                
                console.log('üñ•Ô∏è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:', platform);
                return platform;
            }

            async initialize() {
                this.checkSupport();
                this.updateBadgeDisplay();
                this.updatePlatformInfo();
                this.updateStatus();
                
                // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker
                if ('serviceWorker' in navigator) {
                    try {
                        await navigator.serviceWorker.register('/sw-universal.js');
                        console.log('‚úÖ Universal Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
                    } catch (error) {
                        console.log('‚ùå –û—à–∏–±–∫–∞ Service Worker:', error);
                    }
                }
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–µ–π–¥–∂ –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
                if (this.supportsBadges && this.badgeCount > 0) {
                    await this.setAppBadge(this.badgeCount);
                }
            }

            checkSupport() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                this.supportsNotifications = 'Notification' in window;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –±–µ–π–¥–∂–µ–π (Badging API)
                this.supportsBadges = 'setAppBadge' in navigator && 'clearAppBadge' in navigator;
                
                console.log('üì± –ü–æ–¥–¥–µ—Ä–∂–∫–∞:', {
                    notifications: this.supportsNotifications,
                    badges: this.supportsBadges,
                    platform: this.platform
                });
            }

            // –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –ú–ï–¢–û–î –î–õ–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
            async showNotification(title, body, options = {}) {
                if (!this.supportsNotifications) {
                    this.showStatus('‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º', false);
                    return false;
                }

                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                if (Notification.permission === 'default') {
                    const permission = await Notification.requestPermission();
                    if (permission !== 'granted') {
                        this.showStatus('‚ùå –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ', false);
                        return false;
                    }
                }

                if (Notification.permission === 'granted') {
                    try {
                        // –ë–ê–ó–û–í–´–ï –û–ü–¶–ò–ò –î–õ–Ø –í–°–ï–• –ü–õ–ê–¢–§–û–†–ú
                        const baseOptions = {
                            body: body,
                            icon: this.getProperIcon(),
                            badge: '/icons/badge-72x72.png',
                            tag: 'emiia-notification',
                            requireInteraction: false,
                            silent: false
                        };

                        // –°–ü–ï–¶–ò–§–ò–ß–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò –î–õ–Ø –ü–õ–ê–¢–§–û–†–ú
                        const platformOptions = this.getPlatformSpecificOptions();
                        const finalOptions = { ...baseOptions, ...platformOptions, ...options };

                        console.log('üîî –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', { title, finalOptions });

                        // –ü—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ Service Worker (–ª—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)
                        if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                            const registration = await navigator.serviceWorker.ready;
                            await registration.showNotification(title, finalOptions);
                            console.log('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ Service Worker');
                        } else {
                            // Fallback: –æ–±—ã—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                            const notification = new Notification(title, finalOptions);
                            
                            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                            notification.onclick = () => {
                                window.focus();
                                notification.close();
                                this.handleNotificationClick();
                            };
                            
                            notification.onclose = () => {
                                console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
                            };
                            
                            console.log('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ Notification API');
                        }

                        this.showStatus('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!', true);
                        return true;
                        
                    } catch (error) {
                        console.log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
                        
                        // Fallback: –ø—Ä–æ—Å—Ç–µ–π—à–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                        try {
                            const fallbackNotification = new Notification(title, {
                                body: body,
                                icon: '/logo_wms.svg'
                            });
                            this.showStatus('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (fallback)', true);
                            return true;
                        } catch (fallbackError) {
                            this.showStatus('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ', false);
                            return false;
                        }
                    }
                } else {
                    this.showStatus('‚ùå –†–∞–∑—Ä–µ—à–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞', false);
                    return false;
                }
            }

            // –ü–†–ê–í–ò–õ–¨–ù–´–ï –ò–ö–û–ù–ö–ò –î–õ–Ø –ö–ê–ñ–î–û–ô –ü–õ–ê–¢–§–û–†–ú–´
            getProperIcon() {
                switch(this.platform) {
                    case 'windows':
                        return '/icons/icon-192x192.png'; // –Ø—Ä–∫–∞—è –∏–∫–æ–Ω–∫–∞ –¥–ª—è Windows
                    case 'macos':
                        return '/icons/icon-512x512.png'; // –ë–æ–ª—å—à–∞—è –∏–∫–æ–Ω–∫–∞ –¥–ª—è Mac
                    case 'ios':
                        return '/icons/apple-touch-icon.png'; // Apple Touch Icon
                    default:
                        return '/logo_wms.svg'; // Fallback
                }
            }

            // –°–ü–ï–¶–ò–§–ò–ß–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò –î–õ–Ø –ü–õ–ê–¢–§–û–†–ú
            getPlatformSpecificOptions() {
                const options = {
                    // –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    vibrate: [100, 50, 100],
                    data: { 
                        url: window.location.href,
                        timestamp: Date.now(),
                        platform: this.platform
                    }
                };

                // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º
                switch(this.platform) {
                    case 'windows':
                        // Windows: —è—Ä–∫–∏–µ —Ü–≤–µ—Ç–∞, –≤–∏–±—Ä–∞—Ü–∏—è
                        return {
                            ...options,
                            icon: '/icons/icon-192x192.png',
                            badge: '/icons/badge-72x72.png',
                            requireInteraction: false
                        };
                    
                    case 'macos':
                        // macOS: —á–∏—Å—Ç—ã–π –¥–∏–∑–∞–π–Ω, —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        return {
                            ...options,
                            icon: '/icons/icon-512x512.png',
                            silent: true, // –ú–µ–Ω—å—à–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ Mac
                            requireInteraction: false
                        };
                    
                    case 'ios':
                        // iOS: Apple-style —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        return {
                            ...options,
                            icon: '/icons/apple-touch-icon.png',
                            badge: '/icons/badge-72x72.png',
                            silent: false
                        };
                    
                    default:
                        return options;
                }
            }

            // –£–ü–†–ê–í–õ–ï–ù–ò–ï –ë–ï–ô–î–ñ–ê–ú–ò
            async setAppBadge(count) {
                if (!this.supportsBadges) return false;
                
                try {
                    this.badgeCount = count;
                    localStorage.setItem('badgeCount', count.toString());
                    
                    await navigator.setAppBadge(count);
                    console.log(`üî¥ –ë–µ–π–¥–∂ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${count}`);
                    
                    this.updateBadgeDisplay();
                    return true;
                } catch (error) {
                    console.log('‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–µ–π–¥–∂–∞:', error);
                    return false;
                }
            }

            async addBadge() {
                const newCount = this.badgeCount + 1;
                const badgeSuccess = await this.setAppBadge(newCount);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
                const notificationSuccess = await this.showNotification(
                    'EMIIA.AI',
                    `–£ –≤–∞—Å ${newCount} –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π`,
                    { tag: 'badge-update' }
                );

                if (badgeSuccess || notificationSuccess) {
                    this.showStatus(`üî¥ –ë–µ–π–¥–∂ –æ–±–Ω–æ–≤–ª–µ–Ω: ${newCount}`, true);
                }
            }

            async clearBadge() {
                if (this.supportsBadges) {
                    try {
                        await navigator.clearAppBadge();
                        console.log('‚úÖ –ë–µ–π–¥–∂ —Å–±—Ä–æ—à–µ–Ω');
                    } catch (error) {
                        console.log('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –±–µ–π–¥–∂–∞:', error);
                    }
                }
                
                this.badgeCount = 0;
                localStorage.setItem('badgeCount', '0');
                this.updateBadgeDisplay();
                this.showStatus('‚úÖ –ë–µ–π–¥–∂ —Å–±—Ä–æ—à–µ–Ω', true);
            }

            handleNotificationClick() {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –±–µ–π–¥–∂ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                this.clearBadge();
            }

            // –¢–ï–°–¢ –î–õ–Ø WINDOWS/MAC
            async testDesktopNotification() {
                const testMessages = {
                    windows: "Windows: –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∞–∫—Ç–∏–≤–µ–Ω!",
                    macos: "macOS: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ!",
                    default: "–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!"
                };
                
                const message = testMessages[this.platform] || testMessages.default;
                
                const success = await this.showNotification(
                    'EMIIA.AI –¢–µ—Å—Ç',
                    message,
                    { 
                        icon: this.getProperIcon(),
                        requireInteraction: true // –í–∞–∂–Ω–æ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
                    }
                );
                
                if (success) {
                    await this.addBadge();
                }
            }

            // –û–ë–ù–û–í–õ–ï–ù–ò–ï UI
            updateBadgeDisplay() {
                const badgeEl = document.getElementById('currentBadge');
                if (badgeEl) {
                    badgeEl.textContent = this.badgeCount;
                }
            }

            updatePlatformInfo() {
                const platformEl = document.getElementById('platformInfo');
                if (platformEl) {
                    let platformText = `–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${this.platform.toUpperCase()} | `;
                    platformText += `–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: ${this.supportsNotifications ? '‚úÖ' : '‚ùå'} | `;
                    platformText += `–ë–µ–π–¥–∂–∏: ${this.supportsBadges ? '‚úÖ' : '‚ùå'}`;
                    platformEl.textContent = platformText;
                }
            }

            updateStatus() {
                const statusEl = document.getElementById('notificationStatus');
                if (!statusEl) return;

                if (!this.supportsNotifications) {
                    statusEl.textContent = '‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º';
                    statusEl.className = 'status-message status-error';
                    return;
                }

                switch (Notification.permission) {
                    case 'granted':
                        statusEl.textContent = `‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã (${this.platform})`;
                        statusEl.className = 'status-message status-success';
                        break;
                    case 'denied':
                        statusEl.textContent = '‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã. –†–∞–∑—Ä–µ—à–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.';
                        statusEl.className = 'status-message status-error';
                        break;
                    default:
                        statusEl.textContent = `‚ÑπÔ∏è –ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (${this.platform})`;
                        statusEl.className = 'status-message status-info';
                }
            }

            showStatus(message, isSuccess) {
                const statusEl = document.getElementById('notificationStatus');
                if (statusEl) {
                    statusEl.textContent = message;
                    statusEl.className = `status-message ${isSuccess ? 'status-success' : 'status-error'}`;
                    
                    setTimeout(() => {
                        this.updateStatus();
                    }, 3000);
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        let notificationManager;

        document.addEventListener('DOMContentLoaded', function() {
            notificationManager = new UniversalNotificationManager();

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            document.getElementById('testNotificationBtn').addEventListener('click', async () => {
                const success = await notificationManager.showNotification(
                    'EMIIA.AI –¢–µ—Å—Ç',
                    '–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ –≤–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ! üöÄ'
                );
                
                if (success) {
                    await notificationManager.addBadge();
                }
            });

            document.getElementById('addBadgeBtn').addEventListener('click', () => {
                notificationManager.addBadge();
            });

            document.getElementById('clearBadgeBtn').addEventListener('click', () => {
                notificationManager.clearBadge();
            });

            document.getElementById('testDesktopBtn').addEventListener('click', () => {
                notificationManager.testDesktopNotification();
            });

            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const savedLogin = localStorage.getItem('savedLogin');
            const savedPassword = localStorage.getItem('savedPassword');
            if (savedLogin) document.getElementById('login').value = savedLogin;
            if (savedPassword) document.getElementById('password').value = savedPassword;
        });

        // Telegram Web App
        window.addEventListener('load', () => {
            if (window.Telegram?.WebApp) {
                const tele = window.Telegram.WebApp;
                tele.ready();
                tele.expand();
                tele.setHeaderColor("#f8f9fa");
                tele.setBackgroundColor("#f8f9fa");
            }
        });

        // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const login = document.getElementById('login').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbxOGWk-UgU-UO-TByGvusunKeJmhGV--Wmstne1TKlDW1Oq7QZAeR3zEBHhwHAOuA0P/exec', {
                    method: 'POST',
                    body: new URLSearchParams({ login, password })
                });
                
                if (await response.text() === 'OK') {
                    localStorage.setItem('savedLogin', login);
                    localStorage.setItem('savedPassword', password);
                    
                    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ
                    if (notificationManager) {
                        await notificationManager.showNotification(
                            'EMIIA.AI',
                            '–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É!'
                        );
                        await notificationManager.addBadge();
                    }
                    
                    setTimeout(() => {
                        window.location.href = 'https://sos.emiia.ai/vv1.html?pwa=true';
                    }, 1000);
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!');
                }
            } catch {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            }
        });

        // –î–µ–º–æ: –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        setInterval(() => {
            if (notificationManager && Math.random() > 0.8) {
                const messages = [
                    '–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∞–∫—Ç–∏–≤–µ–Ω',
                    '–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞', 
                    '–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ',
                    '–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º'
                ];
                const message = messages[Math.floor(Math.random() * messages.length)];
                
                notificationManager.showNotification('EMIIA.AI', message);
                notificationManager.addBadge();
            }
        }, 60000);
    </script>
</body>
</html>
